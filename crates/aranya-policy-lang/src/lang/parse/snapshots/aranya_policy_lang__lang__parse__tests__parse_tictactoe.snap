---
source: crates/aranya-policy-lang/src/lang/parse/tests.rs
expression: policy
---
Policy {
    version: V2,
    ffi_imports: [],
    facts: [
        FactDefinition {
            immutable: false,
            identifier: Ident {
                name: "Players",
                span: 42..49,
            },
            key: [
                FieldDefinition {
                    identifier: Ident {
                        name: "gameID",
                        span: 50..56,
                    },
                    field_type: VType {
                        kind: Id,
                        span: 57..59,
                    },
                },
            ],
            value: [
                FieldDefinition {
                    identifier: Ident {
                        name: "x",
                        span: 63..64,
                    },
                    field_type: VType {
                        kind: Id,
                        span: 65..67,
                    },
                },
                FieldDefinition {
                    identifier: Ident {
                        name: "o",
                        span: 69..70,
                    },
                    field_type: VType {
                        kind: Id,
                        span: 71..73,
                    },
                },
            ],
            span: 37..74,
        },
        FactDefinition {
            immutable: false,
            identifier: Ident {
                name: "NextPlayer",
                span: 80..90,
            },
            key: [
                FieldDefinition {
                    identifier: Ident {
                        name: "gameID",
                        span: 91..97,
                    },
                    field_type: VType {
                        kind: Id,
                        span: 98..100,
                    },
                },
            ],
            value: [
                FieldDefinition {
                    identifier: Ident {
                        name: "p",
                        span: 104..105,
                    },
                    field_type: VType {
                        kind: String,
                        span: 106..112,
                    },
                },
            ],
            span: 75..113,
        },
        FactDefinition {
            immutable: false,
            identifier: Ident {
                name: "Field",
                span: 119..124,
            },
            key: [
                FieldDefinition {
                    identifier: Ident {
                        name: "gameID",
                        span: 125..131,
                    },
                    field_type: VType {
                        kind: Id,
                        span: 132..134,
                    },
                },
                FieldDefinition {
                    identifier: Ident {
                        name: "x",
                        span: 136..137,
                    },
                    field_type: VType {
                        kind: Int,
                        span: 138..141,
                    },
                },
                FieldDefinition {
                    identifier: Ident {
                        name: "y",
                        span: 143..144,
                    },
                    field_type: VType {
                        kind: Int,
                        span: 145..148,
                    },
                },
            ],
            value: [
                FieldDefinition {
                    identifier: Ident {
                        name: "p",
                        span: 152..153,
                    },
                    field_type: VType {
                        kind: String,
                        span: 154..160,
                    },
                },
            ],
            span: 114..161,
        },
        FactDefinition {
            immutable: false,
            identifier: Ident {
                name: "GameOver",
                span: 167..175,
            },
            key: [
                FieldDefinition {
                    identifier: Ident {
                        name: "gameID",
                        span: 176..182,
                    },
                    field_type: VType {
                        kind: Id,
                        span: 183..185,
                    },
                },
            ],
            value: [],
            span: 162..190,
        },
    ],
    actions: [
        ActionDefinition {
            persistence: Persistent,
            identifier: Ident {
                name: "StartGame",
                span: 609..618,
            },
            arguments: [
                FieldDefinition {
                    identifier: Ident {
                        name: "profileX",
                        span: 619..627,
                    },
                    field_type: VType {
                        kind: Id,
                        span: 628..630,
                    },
                },
                FieldDefinition {
                    identifier: Ident {
                        name: "profileO",
                        span: 632..640,
                    },
                    field_type: VType {
                        kind: Id,
                        span: 641..643,
                    },
                },
            ],
            statements: [
                Statement {
                    kind: Let(
                        LetStatement {
                            identifier: Ident {
                                name: "start_command",
                                span: 655..668,
                            },
                            expression: Expression {
                                kind: NamedStruct(
                                    NamedStruct {
                                        identifier: Ident {
                                            name: "Start",
                                            span: 671..676,
                                        },
                                        fields: [
                                            (
                                                Ident {
                                                    name: "ProfileX",
                                                    span: 686..694,
                                                },
                                                Expression {
                                                    kind: Identifier(
                                                        Ident {
                                                            name: "profileX",
                                                            span: 696..704,
                                                        },
                                                    ),
                                                    span: 696..704,
                                                },
                                            ),
                                            (
                                                Ident {
                                                    name: "ProfileO",
                                                    span: 714..722,
                                                },
                                                Expression {
                                                    kind: Identifier(
                                                        Ident {
                                                            name: "profileO",
                                                            span: 724..732,
                                                        },
                                                    ),
                                                    span: 724..732,
                                                },
                                            ),
                                        ],
                                        sources: [],
                                    },
                                ),
                                span: 671..739,
                            },
                        },
                    ),
                    span: 651..744,
                },
                Statement {
                    kind: Publish(
                        Expression {
                            kind: Identifier(
                                Ident {
                                    name: "start_command",
                                    span: 752..765,
                                },
                            ),
                            span: 752..765,
                        },
                    ),
                    span: 744..766,
                },
            ],
            span: 602..767,
        },
        ActionDefinition {
            persistence: Persistent,
            identifier: Ident {
                name: "MakeMove",
                span: 1444..1452,
            },
            arguments: [
                FieldDefinition {
                    identifier: Ident {
                        name: "gameID",
                        span: 1453..1459,
                    },
                    field_type: VType {
                        kind: Id,
                        span: 1460..1462,
                    },
                },
                FieldDefinition {
                    identifier: Ident {
                        name: "x",
                        span: 1464..1465,
                    },
                    field_type: VType {
                        kind: Int,
                        span: 1466..1469,
                    },
                },
                FieldDefinition {
                    identifier: Ident {
                        name: "y",
                        span: 1471..1472,
                    },
                    field_type: VType {
                        kind: Int,
                        span: 1473..1476,
                    },
                },
            ],
            statements: [
                Statement {
                    kind: Let(
                        LetStatement {
                            identifier: Ident {
                                name: "move_command",
                                span: 1488..1500,
                            },
                            expression: Expression {
                                kind: NamedStruct(
                                    NamedStruct {
                                        identifier: Ident {
                                            name: "Move",
                                            span: 1503..1507,
                                        },
                                        fields: [
                                            (
                                                Ident {
                                                    name: "gameID",
                                                    span: 1518..1524,
                                                },
                                                Expression {
                                                    kind: Identifier(
                                                        Ident {
                                                            name: "gameID",
                                                            span: 1526..1532,
                                                        },
                                                    ),
                                                    span: 1526..1532,
                                                },
                                            ),
                                            (
                                                Ident {
                                                    name: "X",
                                                    span: 1542..1543,
                                                },
                                                Expression {
                                                    kind: Identifier(
                                                        Ident {
                                                            name: "x",
                                                            span: 1545..1546,
                                                        },
                                                    ),
                                                    span: 1545..1546,
                                                },
                                            ),
                                            (
                                                Ident {
                                                    name: "Y",
                                                    span: 1556..1557,
                                                },
                                                Expression {
                                                    kind: Identifier(
                                                        Ident {
                                                            name: "y",
                                                            span: 1559..1560,
                                                        },
                                                    ),
                                                    span: 1559..1560,
                                                },
                                            ),
                                        ],
                                        sources: [],
                                    },
                                ),
                                span: 1503..1567,
                            },
                        },
                    ),
                    span: 1484..1572,
                },
                Statement {
                    kind: Publish(
                        Expression {
                            kind: Identifier(
                                Ident {
                                    name: "move_command",
                                    span: 1580..1592,
                                },
                            ),
                            span: 1580..1592,
                        },
                    ),
                    span: 1572..1593,
                },
            ],
            span: 1437..1594,
        },
    ],
    effects: [
        EffectDefinition {
            identifier: Ident {
                name: "GameStart",
                span: 776..785,
            },
            items: [
                Field(
                    EffectFieldDefinition {
                        identifier: Ident {
                            name: "gameID",
                            span: 792..798,
                        },
                        field_type: VType {
                            kind: Id,
                            span: 799..801,
                        },
                        dynamic: false,
                    },
                ),
                Field(
                    EffectFieldDefinition {
                        identifier: Ident {
                            name: "x",
                            span: 807..808,
                        },
                        field_type: VType {
                            kind: Id,
                            span: 809..811,
                        },
                        dynamic: false,
                    },
                ),
                Field(
                    EffectFieldDefinition {
                        identifier: Ident {
                            name: "o",
                            span: 817..818,
                        },
                        field_type: VType {
                            kind: Id,
                            span: 819..821,
                        },
                        dynamic: false,
                    },
                ),
            ],
            span: 769..824,
        },
        EffectDefinition {
            identifier: Ident {
                name: "GameUpdate",
                span: 1603..1613,
            },
            items: [
                Field(
                    EffectFieldDefinition {
                        identifier: Ident {
                            name: "gameID",
                            span: 1620..1626,
                        },
                        field_type: VType {
                            kind: Id,
                            span: 1627..1629,
                        },
                        dynamic: false,
                    },
                ),
                Field(
                    EffectFieldDefinition {
                        identifier: Ident {
                            name: "player",
                            span: 1635..1641,
                        },
                        field_type: VType {
                            kind: Id,
                            span: 1642..1644,
                        },
                        dynamic: false,
                    },
                ),
                Field(
                    EffectFieldDefinition {
                        identifier: Ident {
                            name: "p",
                            span: 1802..1803,
                        },
                        field_type: VType {
                            kind: String,
                            span: 1809..1815,
                        },
                        dynamic: true,
                    },
                ),
                Field(
                    EffectFieldDefinition {
                        identifier: Ident {
                            name: "X",
                            span: 1829..1830,
                        },
                        field_type: VType {
                            kind: Int,
                            span: 1836..1839,
                        },
                        dynamic: false,
                    },
                ),
                Field(
                    EffectFieldDefinition {
                        identifier: Ident {
                            name: "Y",
                            span: 1845..1846,
                        },
                        field_type: VType {
                            kind: Int,
                            span: 1852..1855,
                        },
                        dynamic: false,
                    },
                ),
            ],
            span: 1596..1858,
        },
        EffectDefinition {
            identifier: Ident {
                name: "GameOver",
                span: 1867..1875,
            },
            items: [
                Field(
                    EffectFieldDefinition {
                        identifier: Ident {
                            name: "gameID",
                            span: 1882..1888,
                        },
                        field_type: VType {
                            kind: Id,
                            span: 1889..1891,
                        },
                        dynamic: false,
                    },
                ),
                Field(
                    EffectFieldDefinition {
                        identifier: Ident {
                            name: "winner",
                            span: 1897..1903,
                        },
                        field_type: VType {
                            kind: Id,
                            span: 1904..1906,
                        },
                        dynamic: false,
                    },
                ),
                Field(
                    EffectFieldDefinition {
                        identifier: Ident {
                            name: "p",
                            span: 1912..1913,
                        },
                        field_type: VType {
                            kind: String,
                            span: 1914..1920,
                        },
                        dynamic: false,
                    },
                ),
            ],
            span: 1860..1923,
        },
    ],
    structs: [],
    enums: [],
    commands: [
        CommandDefinition {
            persistence: Persistent,
            attributes: [],
            identifier: Ident {
                name: "Start",
                span: 834..839,
            },
            fields: [
                Field(
                    FieldDefinition {
                        identifier: Ident {
                            name: "ProfileX",
                            span: 863..871,
                        },
                        field_type: VType {
                            kind: Id,
                            span: 872..874,
                        },
                    },
                ),
                Field(
                    FieldDefinition {
                        identifier: Ident {
                            name: "ProfileO",
                            span: 884..892,
                        },
                        field_type: VType {
                            kind: Id,
                            span: 893..895,
                        },
                    },
                ),
            ],
            seal: [],
            open: [],
            policy: [
                Statement {
                    kind: Check(
                        CheckStatement {
                            expression: Expression {
                                kind: NotEqual(
                                    Expression {
                                        kind: Identifier(
                                            Ident {
                                                name: "ProfileX",
                                                span: 931..939,
                                            },
                                        ),
                                        span: 931..939,
                                    },
                                    Expression {
                                        kind: Identifier(
                                            Ident {
                                                name: "ProfileO",
                                                span: 943..951,
                                            },
                                        ),
                                        span: 943..951,
                                    },
                                ),
                                span: 931..951,
                            },
                        },
                    ),
                    span: 925..1091,
                },
                Statement {
                    kind: Let(
                        LetStatement {
                            identifier: Ident {
                                name: "gameID",
                                span: 1095..1101,
                            },
                            expression: Expression {
                                kind: ForeignFunctionCall(
                                    ForeignFunctionCall {
                                        module: Ident {
                                            name: "envelope",
                                            span: 1104..1112,
                                        },
                                        identifier: Ident {
                                            name: "command_id",
                                            span: 1114..1124,
                                        },
                                        arguments: [
                                            Expression {
                                                kind: Identifier(
                                                    Ident {
                                                        name: "envelope",
                                                        span: 1125..1133,
                                                    },
                                                ),
                                                span: 1125..1133,
                                            },
                                        ],
                                    },
                                ),
                                span: 1104..1134,
                            },
                        },
                    ),
                    span: 1091..1143,
                },
                Statement {
                    kind: Finish(
                        [
                            Statement {
                                kind: Create(
                                    CreateStatement {
                                        fact: FactLiteral {
                                            identifier: Ident {
                                                name: "PlayerProfile",
                                                span: 1171..1184,
                                            },
                                            key_fields: [
                                                (
                                                    Ident {
                                                        name: "gameID",
                                                        span: 1185..1191,
                                                    },
                                                    Expression(
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "gameID",
                                                                    span: 1193..1199,
                                                                },
                                                            ),
                                                            span: 1193..1199,
                                                        },
                                                    ),
                                                ),
                                            ],
                                            value_fields: Some(
                                                [
                                                    (
                                                        Ident {
                                                            name: "x",
                                                            span: 1203..1204,
                                                        },
                                                        Expression(
                                                            Expression {
                                                                kind: Identifier(
                                                                    Ident {
                                                                        name: "ProfileX",
                                                                        span: 1206..1214,
                                                                    },
                                                                ),
                                                                span: 1206..1214,
                                                            },
                                                        ),
                                                    ),
                                                    (
                                                        Ident {
                                                            name: "o",
                                                            span: 1216..1217,
                                                        },
                                                        Expression(
                                                            Expression {
                                                                kind: Identifier(
                                                                    Ident {
                                                                        name: "ProfileO",
                                                                        span: 1219..1227,
                                                                    },
                                                                ),
                                                                span: 1219..1227,
                                                            },
                                                        ),
                                                    ),
                                                ],
                                            ),
                                        },
                                    },
                                ),
                                span: 1164..1228,
                            },
                            Statement {
                                kind: Create(
                                    CreateStatement {
                                        fact: FactLiteral {
                                            identifier: Ident {
                                                name: "NextPlayer",
                                                span: 1248..1258,
                                            },
                                            key_fields: [
                                                (
                                                    Ident {
                                                        name: "gameID",
                                                        span: 1259..1265,
                                                    },
                                                    Expression(
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "gameID",
                                                                    span: 1267..1273,
                                                                },
                                                            ),
                                                            span: 1267..1273,
                                                        },
                                                    ),
                                                ),
                                            ],
                                            value_fields: Some(
                                                [
                                                    (
                                                        Ident {
                                                            name: "p",
                                                            span: 1277..1278,
                                                        },
                                                        Expression(
                                                            Expression {
                                                                kind: String(
                                                                    "X",
                                                                ),
                                                                span: 1280..1283,
                                                            },
                                                        ),
                                                    ),
                                                ],
                                            ),
                                        },
                                    },
                                ),
                                span: 1241..1284,
                            },
                            Statement {
                                kind: Emit(
                                    Expression {
                                        kind: NamedStruct(
                                            NamedStruct {
                                                identifier: Ident {
                                                    name: "GameStart",
                                                    span: 1303..1312,
                                                },
                                                fields: [
                                                    (
                                                        Ident {
                                                            name: "gameID",
                                                            span: 1330..1336,
                                                        },
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "gameID",
                                                                    span: 1338..1344,
                                                                },
                                                            ),
                                                            span: 1338..1344,
                                                        },
                                                    ),
                                                    (
                                                        Ident {
                                                            name: "x",
                                                            span: 1362..1363,
                                                        },
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "ProfileX",
                                                                    span: 1365..1373,
                                                                },
                                                            ),
                                                            span: 1365..1373,
                                                        },
                                                    ),
                                                    (
                                                        Ident {
                                                            name: "o",
                                                            span: 1391..1392,
                                                        },
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "ProfileO",
                                                                    span: 1394..1402,
                                                                },
                                                            ),
                                                            span: 1394..1402,
                                                        },
                                                    ),
                                                ],
                                                sources: [],
                                            },
                                        ),
                                        span: 1303..1417,
                                    },
                                ),
                                span: 1298..1426,
                            },
                        ],
                    ),
                    span: 1143..1427,
                },
            ],
            recall: [],
            span: 826..1435,
        },
        CommandDefinition {
            persistence: Persistent,
            attributes: [],
            identifier: Ident {
                name: "Move",
                span: 1933..1937,
            },
            fields: [
                Field(
                    FieldDefinition {
                        identifier: Ident {
                            name: "gameID",
                            span: 2002..2008,
                        },
                        field_type: VType {
                            kind: Id,
                            span: 2009..2011,
                        },
                    },
                ),
                Field(
                    FieldDefinition {
                        identifier: Ident {
                            name: "X",
                            span: 2021..2022,
                        },
                        field_type: VType {
                            kind: Int,
                            span: 2023..2026,
                        },
                    },
                ),
                Field(
                    FieldDefinition {
                        identifier: Ident {
                            name: "Y",
                            span: 2036..2037,
                        },
                        field_type: VType {
                            kind: Int,
                            span: 2038..2041,
                        },
                    },
                ),
            ],
            seal: [],
            open: [],
            policy: [
                Statement {
                    kind: Let(
                        LetStatement {
                            identifier: Ident {
                                name: "player",
                                span: 2455..2461,
                            },
                            expression: Expression {
                                kind: ForeignFunctionCall(
                                    ForeignFunctionCall {
                                        module: Ident {
                                            name: "envelope",
                                            span: 2464..2472,
                                        },
                                        identifier: Ident {
                                            name: "author_id",
                                            span: 2474..2483,
                                        },
                                        arguments: [
                                            Expression {
                                                kind: Identifier(
                                                    Ident {
                                                        name: "envelope",
                                                        span: 2484..2492,
                                                    },
                                                ),
                                                span: 2484..2492,
                                            },
                                        ],
                                    },
                                ),
                                span: 2464..2493,
                            },
                        },
                    ),
                    span: 2451..2795,
                },
                Statement {
                    kind: Let(
                        LetStatement {
                            identifier: Ident {
                                name: "result",
                                span: 2799..2805,
                            },
                            expression: Expression {
                                kind: Unwrap(
                                    Expression {
                                        kind: InternalFunction(
                                            Query(
                                                FactLiteral {
                                                    identifier: Ident {
                                                        name: "PlayerProfile",
                                                        span: 2821..2834,
                                                    },
                                                    key_fields: [
                                                        (
                                                            Ident {
                                                                name: "gameID",
                                                                span: 2835..2841,
                                                            },
                                                            Expression(
                                                                Expression {
                                                                    kind: Identifier(
                                                                        Ident {
                                                                            name: "gameID",
                                                                            span: 2843..2849,
                                                                        },
                                                                    ),
                                                                    span: 2843..2849,
                                                                },
                                                            ),
                                                        ),
                                                    ],
                                                    value_fields: Some(
                                                        [
                                                            (
                                                                Ident {
                                                                    name: "x",
                                                                    span: 2853..2854,
                                                                },
                                                                Bind(
                                                                    2856..2857,
                                                                ),
                                                            ),
                                                            (
                                                                Ident {
                                                                    name: "o",
                                                                    span: 2859..2860,
                                                                },
                                                                Bind(
                                                                    2862..2863,
                                                                ),
                                                            ),
                                                        ],
                                                    ),
                                                },
                                            ),
                                        ),
                                        span: 2815..2864,
                                    },
                                ),
                                span: 2808..2864,
                            },
                        },
                    ),
                    span: 2795..2873,
                },
                Statement {
                    kind: Let(
                        LetStatement {
                            identifier: Ident {
                                name: "playerX",
                                span: 2877..2884,
                            },
                            expression: Expression {
                                kind: Dot(
                                    Expression {
                                        kind: Identifier(
                                            Ident {
                                                name: "result",
                                                span: 2887..2893,
                                            },
                                        ),
                                        span: 2887..2893,
                                    },
                                    Ident {
                                        name: "x",
                                        span: 2894..2895,
                                    },
                                ),
                                span: 2887..2895,
                            },
                        },
                    ),
                    span: 2873..2904,
                },
                Statement {
                    kind: Let(
                        LetStatement {
                            identifier: Ident {
                                name: "playerO",
                                span: 2908..2915,
                            },
                            expression: Expression {
                                kind: Dot(
                                    Expression {
                                        kind: Identifier(
                                            Ident {
                                                name: "result",
                                                span: 2918..2924,
                                            },
                                        ),
                                        span: 2918..2924,
                                    },
                                    Ident {
                                        name: "o",
                                        span: 2925..2926,
                                    },
                                ),
                                span: 2918..2926,
                            },
                        },
                    ),
                    span: 2904..2935,
                },
                Statement {
                    kind: Let(
                        LetStatement {
                            identifier: Ident {
                                name: "p",
                                span: 2939..2940,
                            },
                            expression: Expression {
                                kind: Unwrap(
                                    Expression {
                                        kind: InternalFunction(
                                            Query(
                                                FactLiteral {
                                                    identifier: Ident {
                                                        name: "NextPlayer",
                                                        span: 2956..2966,
                                                    },
                                                    key_fields: [
                                                        (
                                                            Ident {
                                                                name: "gameID",
                                                                span: 2967..2973,
                                                            },
                                                            Expression(
                                                                Expression {
                                                                    kind: Identifier(
                                                                        Ident {
                                                                            name: "gameID",
                                                                            span: 2975..2981,
                                                                        },
                                                                    ),
                                                                    span: 2975..2981,
                                                                },
                                                            ),
                                                        ),
                                                    ],
                                                    value_fields: Some(
                                                        [
                                                            (
                                                                Ident {
                                                                    name: "p",
                                                                    span: 2985..2986,
                                                                },
                                                                Bind(
                                                                    2988..2989,
                                                                ),
                                                            ),
                                                        ],
                                                    ),
                                                },
                                            ),
                                        ),
                                        span: 2950..2990,
                                    },
                                ),
                                span: 2943..2990,
                            },
                        },
                    ),
                    span: 2935..3111,
                },
                Statement {
                    kind: Let(
                        LetStatement {
                            identifier: Ident {
                                name: "nextp",
                                span: 3115..3120,
                            },
                            expression: Expression {
                                kind: InternalFunction(
                                    If(
                                        Expression {
                                            kind: Equal(
                                                Expression {
                                                    kind: Identifier(
                                                        Ident {
                                                            name: "p",
                                                            span: 3126..3127,
                                                        },
                                                    ),
                                                    span: 3126..3127,
                                                },
                                                Expression {
                                                    kind: String(
                                                        "X",
                                                    ),
                                                    span: 3131..3134,
                                                },
                                            ),
                                            span: 3126..3134,
                                        },
                                        Expression {
                                            kind: Block(
                                                [],
                                                Expression {
                                                    kind: String(
                                                        "O",
                                                    ),
                                                    span: 3138..3141,
                                                },
                                            ),
                                            span: 3135..3143,
                                        },
                                        Expression {
                                            kind: Block(
                                                [],
                                                Expression {
                                                    kind: String(
                                                        "X",
                                                    ),
                                                    span: 3152..3155,
                                                },
                                            ),
                                            span: 3149..3157,
                                        },
                                    ),
                                ),
                                span: 3123..3157,
                            },
                        },
                    ),
                    span: 3111..3400,
                },
                Statement {
                    kind: Check(
                        CheckStatement {
                            expression: Expression {
                                kind: Or(
                                    Expression {
                                        kind: And(
                                            Expression {
                                                kind: Equal(
                                                    Expression {
                                                        kind: Identifier(
                                                            Ident {
                                                                name: "p",
                                                                span: 3407..3408,
                                                            },
                                                        ),
                                                        span: 3407..3408,
                                                    },
                                                    Expression {
                                                        kind: String(
                                                            "X",
                                                        ),
                                                        span: 3412..3415,
                                                    },
                                                ),
                                                span: 3407..3415,
                                            },
                                            Expression {
                                                kind: Equal(
                                                    Expression {
                                                        kind: Identifier(
                                                            Ident {
                                                                name: "player",
                                                                span: 3419..3425,
                                                            },
                                                        ),
                                                        span: 3419..3425,
                                                    },
                                                    Expression {
                                                        kind: Identifier(
                                                            Ident {
                                                                name: "playerX",
                                                                span: 3429..3436,
                                                            },
                                                        ),
                                                        span: 3429..3436,
                                                    },
                                                ),
                                                span: 3419..3436,
                                            },
                                        ),
                                        span: 3407..3436,
                                    },
                                    Expression {
                                        kind: And(
                                            Expression {
                                                kind: Equal(
                                                    Expression {
                                                        kind: Identifier(
                                                            Ident {
                                                                name: "p",
                                                                span: 3442..3443,
                                                            },
                                                        ),
                                                        span: 3442..3443,
                                                    },
                                                    Expression {
                                                        kind: String(
                                                            "O",
                                                        ),
                                                        span: 3447..3450,
                                                    },
                                                ),
                                                span: 3442..3450,
                                            },
                                            Expression {
                                                kind: Equal(
                                                    Expression {
                                                        kind: Identifier(
                                                            Ident {
                                                                name: "player",
                                                                span: 3454..3460,
                                                            },
                                                        ),
                                                        span: 3454..3460,
                                                    },
                                                    Expression {
                                                        kind: Identifier(
                                                            Ident {
                                                                name: "playerO",
                                                                span: 3464..3471,
                                                            },
                                                        ),
                                                        span: 3464..3471,
                                                    },
                                                ),
                                                span: 3454..3471,
                                            },
                                        ),
                                        span: 3442..3471,
                                    },
                                ),
                                span: 3407..3471,
                            },
                        },
                    ),
                    span: 3400..3532,
                },
                Statement {
                    kind: Check(
                        CheckStatement {
                            expression: Expression {
                                kind: FunctionCall(
                                    FunctionCall {
                                        identifier: Ident {
                                            name: "bounds",
                                            span: 3538..3544,
                                        },
                                        arguments: [
                                            Expression {
                                                kind: Identifier(
                                                    Ident {
                                                        name: "X",
                                                        span: 3545..3546,
                                                    },
                                                ),
                                                span: 3545..3546,
                                            },
                                        ],
                                    },
                                ),
                                span: 3538..3547,
                            },
                        },
                    ),
                    span: 3532..3556,
                },
                Statement {
                    kind: Check(
                        CheckStatement {
                            expression: Expression {
                                kind: FunctionCall(
                                    FunctionCall {
                                        identifier: Ident {
                                            name: "bounds",
                                            span: 3562..3568,
                                        },
                                        arguments: [
                                            Expression {
                                                kind: Identifier(
                                                    Ident {
                                                        name: "Y",
                                                        span: 3569..3570,
                                                    },
                                                ),
                                                span: 3569..3570,
                                            },
                                        ],
                                    },
                                ),
                                span: 3562..3571,
                            },
                        },
                    ),
                    span: 3556..3783,
                },
                Statement {
                    kind: Finish(
                        [
                            Statement {
                                kind: Create(
                                    CreateStatement {
                                        fact: FactLiteral {
                                            identifier: Ident {
                                                name: "Field",
                                                span: 3811..3816,
                                            },
                                            key_fields: [
                                                (
                                                    Ident {
                                                        name: "gameID",
                                                        span: 3817..3823,
                                                    },
                                                    Expression(
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "gameID",
                                                                    span: 3825..3831,
                                                                },
                                                            ),
                                                            span: 3825..3831,
                                                        },
                                                    ),
                                                ),
                                                (
                                                    Ident {
                                                        name: "x",
                                                        span: 3833..3834,
                                                    },
                                                    Expression(
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "X",
                                                                    span: 3836..3837,
                                                                },
                                                            ),
                                                            span: 3836..3837,
                                                        },
                                                    ),
                                                ),
                                                (
                                                    Ident {
                                                        name: "y",
                                                        span: 3839..3840,
                                                    },
                                                    Expression(
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "Y",
                                                                    span: 3842..3843,
                                                                },
                                                            ),
                                                            span: 3842..3843,
                                                        },
                                                    ),
                                                ),
                                            ],
                                            value_fields: Some(
                                                [
                                                    (
                                                        Ident {
                                                            name: "p",
                                                            span: 3847..3848,
                                                        },
                                                        Expression(
                                                            Expression {
                                                                kind: Identifier(
                                                                    Ident {
                                                                        name: "p",
                                                                        span: 3850..3851,
                                                                    },
                                                                ),
                                                                span: 3850..3851,
                                                            },
                                                        ),
                                                    ),
                                                ],
                                            ),
                                        },
                                    },
                                ),
                                span: 3804..3852,
                            },
                            Statement {
                                kind: FunctionCall(
                                    FunctionCall {
                                        identifier: Ident {
                                            name: "set_next_player",
                                            span: 3865..3880,
                                        },
                                        arguments: [
                                            Expression {
                                                kind: Identifier(
                                                    Ident {
                                                        name: "gameID",
                                                        span: 3881..3887,
                                                    },
                                                ),
                                                span: 3881..3887,
                                            },
                                            Expression {
                                                kind: Identifier(
                                                    Ident {
                                                        name: "nextp",
                                                        span: 3889..3894,
                                                    },
                                                ),
                                                span: 3889..3894,
                                            },
                                        ],
                                    },
                                ),
                                span: 3865..3895,
                            },
                            Statement {
                                kind: Emit(
                                    Expression {
                                        kind: NamedStruct(
                                            NamedStruct {
                                                identifier: Ident {
                                                    name: "GameUpdate",
                                                    span: 3914..3924,
                                                },
                                                fields: [
                                                    (
                                                        Ident {
                                                            name: "gameID",
                                                            span: 3942..3948,
                                                        },
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "gameID",
                                                                    span: 3950..3956,
                                                                },
                                                            ),
                                                            span: 3950..3956,
                                                        },
                                                    ),
                                                    (
                                                        Ident {
                                                            name: "player",
                                                            span: 3974..3980,
                                                        },
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "player",
                                                                    span: 3982..3988,
                                                                },
                                                            ),
                                                            span: 3982..3988,
                                                        },
                                                    ),
                                                    (
                                                        Ident {
                                                            name: "p",
                                                            span: 4006..4007,
                                                        },
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "p",
                                                                    span: 4009..4010,
                                                                },
                                                            ),
                                                            span: 4009..4010,
                                                        },
                                                    ),
                                                    (
                                                        Ident {
                                                            name: "X",
                                                            span: 4028..4029,
                                                        },
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "X",
                                                                    span: 4031..4032,
                                                                },
                                                            ),
                                                            span: 4031..4032,
                                                        },
                                                    ),
                                                    (
                                                        Ident {
                                                            name: "Y",
                                                            span: 4050..4051,
                                                        },
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "Y",
                                                                    span: 4053..4054,
                                                                },
                                                            ),
                                                            span: 4053..4054,
                                                        },
                                                    ),
                                                ],
                                                sources: [],
                                            },
                                        ),
                                        span: 3914..4069,
                                    },
                                ),
                                span: 3909..4078,
                            },
                        ],
                    ),
                    span: 3783..4079,
                },
            ],
            recall: [],
            span: 1925..4087,
        },
        CommandDefinition {
            persistence: Persistent,
            attributes: [],
            identifier: Ident {
                name: "Move2",
                span: 5551..5556,
            },
            fields: [
                Field(
                    FieldDefinition {
                        identifier: Ident {
                            name: "gameID",
                            span: 5580..5586,
                        },
                        field_type: VType {
                            kind: Id,
                            span: 5587..5589,
                        },
                    },
                ),
                Field(
                    FieldDefinition {
                        identifier: Ident {
                            name: "X",
                            span: 5599..5600,
                        },
                        field_type: VType {
                            kind: Int,
                            span: 5601..5604,
                        },
                    },
                ),
                Field(
                    FieldDefinition {
                        identifier: Ident {
                            name: "Y",
                            span: 5614..5615,
                        },
                        field_type: VType {
                            kind: Int,
                            span: 5616..5619,
                        },
                    },
                ),
            ],
            seal: [],
            open: [],
            policy: [
                Statement {
                    kind: Let(
                        LetStatement {
                            identifier: Ident {
                                name: "player",
                                span: 5653..5659,
                            },
                            expression: Expression {
                                kind: ForeignFunctionCall(
                                    ForeignFunctionCall {
                                        module: Ident {
                                            name: "envelope",
                                            span: 5662..5670,
                                        },
                                        identifier: Ident {
                                            name: "author_id",
                                            span: 5672..5681,
                                        },
                                        arguments: [
                                            Expression {
                                                kind: Identifier(
                                                    Ident {
                                                        name: "envelope",
                                                        span: 5682..5690,
                                                    },
                                                ),
                                                span: 5682..5690,
                                            },
                                        ],
                                    },
                                ),
                                span: 5662..5691,
                            },
                        },
                    ),
                    span: 5649..5700,
                },
                Statement {
                    kind: Let(
                        LetStatement {
                            identifier: Ident {
                                name: "players",
                                span: 5704..5711,
                            },
                            expression: Expression {
                                kind: Unwrap(
                                    Expression {
                                        kind: InternalFunction(
                                            Query(
                                                FactLiteral {
                                                    identifier: Ident {
                                                        name: "PlayerProfile",
                                                        span: 5727..5740,
                                                    },
                                                    key_fields: [
                                                        (
                                                            Ident {
                                                                name: "gameID",
                                                                span: 5741..5747,
                                                            },
                                                            Expression(
                                                                Expression {
                                                                    kind: Identifier(
                                                                        Ident {
                                                                            name: "gameID",
                                                                            span: 5749..5755,
                                                                        },
                                                                    ),
                                                                    span: 5749..5755,
                                                                },
                                                            ),
                                                        ),
                                                    ],
                                                    value_fields: Some(
                                                        [
                                                            (
                                                                Ident {
                                                                    name: "x",
                                                                    span: 5759..5760,
                                                                },
                                                                Bind(
                                                                    5762..5763,
                                                                ),
                                                            ),
                                                            (
                                                                Ident {
                                                                    name: "o",
                                                                    span: 5765..5766,
                                                                },
                                                                Bind(
                                                                    5768..5769,
                                                                ),
                                                            ),
                                                        ],
                                                    ),
                                                },
                                            ),
                                        ),
                                        span: 5721..5770,
                                    },
                                ),
                                span: 5714..5770,
                            },
                        },
                    ),
                    span: 5700..5779,
                },
                Statement {
                    kind: Let(
                        LetStatement {
                            identifier: Ident {
                                name: "p",
                                span: 5783..5784,
                            },
                            expression: Expression {
                                kind: Unwrap(
                                    Expression {
                                        kind: InternalFunction(
                                            Query(
                                                FactLiteral {
                                                    identifier: Ident {
                                                        name: "NextPlayer",
                                                        span: 5800..5810,
                                                    },
                                                    key_fields: [
                                                        (
                                                            Ident {
                                                                name: "gameID",
                                                                span: 5811..5817,
                                                            },
                                                            Expression(
                                                                Expression {
                                                                    kind: Identifier(
                                                                        Ident {
                                                                            name: "gameID",
                                                                            span: 5819..5825,
                                                                        },
                                                                    ),
                                                                    span: 5819..5825,
                                                                },
                                                            ),
                                                        ),
                                                    ],
                                                    value_fields: Some(
                                                        [
                                                            (
                                                                Ident {
                                                                    name: "p",
                                                                    span: 5829..5830,
                                                                },
                                                                Bind(
                                                                    5832..5833,
                                                                ),
                                                            ),
                                                        ],
                                                    ),
                                                },
                                            ),
                                        ),
                                        span: 5794..5834,
                                    },
                                ),
                                span: 5787..5834,
                            },
                        },
                    ),
                    span: 5779..5843,
                },
                Statement {
                    kind: Let(
                        LetStatement {
                            identifier: Ident {
                                name: "nextp",
                                span: 5847..5852,
                            },
                            expression: Expression {
                                kind: InternalFunction(
                                    If(
                                        Expression {
                                            kind: Equal(
                                                Expression {
                                                    kind: Identifier(
                                                        Ident {
                                                            name: "p",
                                                            span: 5858..5859,
                                                        },
                                                    ),
                                                    span: 5858..5859,
                                                },
                                                Expression {
                                                    kind: String(
                                                        "X",
                                                    ),
                                                    span: 5863..5866,
                                                },
                                            ),
                                            span: 5858..5866,
                                        },
                                        Expression {
                                            kind: Block(
                                                [],
                                                Expression {
                                                    kind: String(
                                                        "O",
                                                    ),
                                                    span: 5870..5873,
                                                },
                                            ),
                                            span: 5867..5875,
                                        },
                                        Expression {
                                            kind: Block(
                                                [],
                                                Expression {
                                                    kind: String(
                                                        "X",
                                                    ),
                                                    span: 5884..5887,
                                                },
                                            ),
                                            span: 5881..5889,
                                        },
                                    ),
                                ),
                                span: 5855..5889,
                            },
                        },
                    ),
                    span: 5843..5899,
                },
                Statement {
                    kind: Check(
                        CheckStatement {
                            expression: Expression {
                                kind: Not(
                                    Expression {
                                        kind: InternalFunction(
                                            Exists(
                                                FactLiteral {
                                                    identifier: Ident {
                                                        name: "GameOver",
                                                        span: 5913..5921,
                                                    },
                                                    key_fields: [
                                                        (
                                                            Ident {
                                                                name: "gameID",
                                                                span: 5922..5928,
                                                            },
                                                            Expression(
                                                                Expression {
                                                                    kind: Identifier(
                                                                        Ident {
                                                                            name: "gameID",
                                                                            span: 5930..5936,
                                                                        },
                                                                    ),
                                                                    span: 5930..5936,
                                                                },
                                                            ),
                                                        ),
                                                    ],
                                                    value_fields: Some(
                                                        [],
                                                    ),
                                                },
                                            ),
                                        ),
                                        span: 5906..5941,
                                    },
                                ),
                                span: 5905..5941,
                            },
                        },
                    ),
                    span: 5899..5950,
                },
                Statement {
                    kind: Check(
                        CheckStatement {
                            expression: Expression {
                                kind: FunctionCall(
                                    FunctionCall {
                                        identifier: Ident {
                                            name: "bounds",
                                            span: 5956..5962,
                                        },
                                        arguments: [
                                            Expression {
                                                kind: Identifier(
                                                    Ident {
                                                        name: "X",
                                                        span: 5963..5964,
                                                    },
                                                ),
                                                span: 5963..5964,
                                            },
                                        ],
                                    },
                                ),
                                span: 5956..5965,
                            },
                        },
                    ),
                    span: 5950..5974,
                },
                Statement {
                    kind: Check(
                        CheckStatement {
                            expression: Expression {
                                kind: FunctionCall(
                                    FunctionCall {
                                        identifier: Ident {
                                            name: "bounds",
                                            span: 5980..5986,
                                        },
                                        arguments: [
                                            Expression {
                                                kind: Identifier(
                                                    Ident {
                                                        name: "Y",
                                                        span: 5987..5988,
                                                    },
                                                ),
                                                span: 5987..5988,
                                            },
                                        ],
                                    },
                                ),
                                span: 5980..5989,
                            },
                        },
                    ),
                    span: 5974..5998,
                },
                Statement {
                    kind: Check(
                        CheckStatement {
                            expression: Expression {
                                kind: Or(
                                    Expression {
                                        kind: And(
                                            Expression {
                                                kind: Equal(
                                                    Expression {
                                                        kind: Identifier(
                                                            Ident {
                                                                name: "p",
                                                                span: 6005..6006,
                                                            },
                                                        ),
                                                        span: 6005..6006,
                                                    },
                                                    Expression {
                                                        kind: String(
                                                            "X",
                                                        ),
                                                        span: 6010..6013,
                                                    },
                                                ),
                                                span: 6005..6013,
                                            },
                                            Expression {
                                                kind: Equal(
                                                    Expression {
                                                        kind: Identifier(
                                                            Ident {
                                                                name: "player",
                                                                span: 6017..6023,
                                                            },
                                                        ),
                                                        span: 6017..6023,
                                                    },
                                                    Expression {
                                                        kind: Dot(
                                                            Expression {
                                                                kind: Identifier(
                                                                    Ident {
                                                                        name: "players",
                                                                        span: 6027..6034,
                                                                    },
                                                                ),
                                                                span: 6027..6034,
                                                            },
                                                            Ident {
                                                                name: "x",
                                                                span: 6035..6036,
                                                            },
                                                        ),
                                                        span: 6027..6036,
                                                    },
                                                ),
                                                span: 6017..6036,
                                            },
                                        ),
                                        span: 6005..6036,
                                    },
                                    Expression {
                                        kind: And(
                                            Expression {
                                                kind: Equal(
                                                    Expression {
                                                        kind: Identifier(
                                                            Ident {
                                                                name: "p",
                                                                span: 6042..6043,
                                                            },
                                                        ),
                                                        span: 6042..6043,
                                                    },
                                                    Expression {
                                                        kind: String(
                                                            "O",
                                                        ),
                                                        span: 6047..6050,
                                                    },
                                                ),
                                                span: 6042..6050,
                                            },
                                            Expression {
                                                kind: Equal(
                                                    Expression {
                                                        kind: Identifier(
                                                            Ident {
                                                                name: "player",
                                                                span: 6054..6060,
                                                            },
                                                        ),
                                                        span: 6054..6060,
                                                    },
                                                    Expression {
                                                        kind: Dot(
                                                            Expression {
                                                                kind: Identifier(
                                                                    Ident {
                                                                        name: "players",
                                                                        span: 6064..6071,
                                                                    },
                                                                ),
                                                                span: 6064..6071,
                                                            },
                                                            Ident {
                                                                name: "o",
                                                                span: 6072..6073,
                                                            },
                                                        ),
                                                        span: 6064..6073,
                                                    },
                                                ),
                                                span: 6054..6073,
                                            },
                                        ),
                                        span: 6042..6073,
                                    },
                                ),
                                span: 6005..6073,
                            },
                        },
                    ),
                    span: 5998..6084,
                },
                Statement {
                    kind: Match(
                        MatchStatement {
                            expression: Expression {
                                kind: FunctionCall(
                                    FunctionCall {
                                        identifier: Ident {
                                            name: "game_over",
                                            span: 6090..6099,
                                        },
                                        arguments: [
                                            Expression {
                                                kind: Identifier(
                                                    Ident {
                                                        name: "gameID",
                                                        span: 6100..6106,
                                                    },
                                                ),
                                                span: 6100..6106,
                                            },
                                            Expression {
                                                kind: Identifier(
                                                    Ident {
                                                        name: "X",
                                                        span: 6108..6109,
                                                    },
                                                ),
                                                span: 6108..6109,
                                            },
                                            Expression {
                                                kind: Identifier(
                                                    Ident {
                                                        name: "Y",
                                                        span: 6111..6112,
                                                    },
                                                ),
                                                span: 6111..6112,
                                            },
                                            Expression {
                                                kind: Identifier(
                                                    Ident {
                                                        name: "p",
                                                        span: 6114..6115,
                                                    },
                                                ),
                                                span: 6114..6115,
                                            },
                                        ],
                                    },
                                ),
                                span: 6090..6116,
                            },
                            arms: [
                                MatchArm {
                                    pattern: Values(
                                        [
                                            Expression {
                                                kind: Bool(
                                                    true,
                                                ),
                                                span: 6131..6135,
                                            },
                                        ],
                                    ),
                                    statements: [
                                        Statement {
                                            kind: Finish(
                                                [
                                                    Statement {
                                                        kind: Create(
                                                            CreateStatement {
                                                                fact: FactLiteral {
                                                                    identifier: Ident {
                                                                        name: "Field",
                                                                        span: 6193..6198,
                                                                    },
                                                                    key_fields: [
                                                                        (
                                                                            Ident {
                                                                                name: "gameID",
                                                                                span: 6199..6205,
                                                                            },
                                                                            Expression(
                                                                                Expression {
                                                                                    kind: Identifier(
                                                                                        Ident {
                                                                                            name: "gameID",
                                                                                            span: 6207..6213,
                                                                                        },
                                                                                    ),
                                                                                    span: 6207..6213,
                                                                                },
                                                                            ),
                                                                        ),
                                                                        (
                                                                            Ident {
                                                                                name: "x",
                                                                                span: 6215..6216,
                                                                            },
                                                                            Expression(
                                                                                Expression {
                                                                                    kind: Identifier(
                                                                                        Ident {
                                                                                            name: "X",
                                                                                            span: 6218..6219,
                                                                                        },
                                                                                    ),
                                                                                    span: 6218..6219,
                                                                                },
                                                                            ),
                                                                        ),
                                                                        (
                                                                            Ident {
                                                                                name: "y",
                                                                                span: 6221..6222,
                                                                            },
                                                                            Expression(
                                                                                Expression {
                                                                                    kind: Identifier(
                                                                                        Ident {
                                                                                            name: "Y",
                                                                                            span: 6224..6225,
                                                                                        },
                                                                                    ),
                                                                                    span: 6224..6225,
                                                                                },
                                                                            ),
                                                                        ),
                                                                    ],
                                                                    value_fields: Some(
                                                                        [
                                                                            (
                                                                                Ident {
                                                                                    name: "p",
                                                                                    span: 6229..6230,
                                                                                },
                                                                                Expression(
                                                                                    Expression {
                                                                                        kind: Identifier(
                                                                                            Ident {
                                                                                                name: "p",
                                                                                                span: 6232..6233,
                                                                                            },
                                                                                        ),
                                                                                        span: 6232..6233,
                                                                                    },
                                                                                ),
                                                                            ),
                                                                        ],
                                                                    ),
                                                                },
                                                            },
                                                        ),
                                                        span: 6186..6234,
                                                    },
                                                    Statement {
                                                        kind: Delete(
                                                            DeleteStatement {
                                                                fact: FactLiteral {
                                                                    identifier: Ident {
                                                                        name: "NextPlayer",
                                                                        span: 6262..6272,
                                                                    },
                                                                    key_fields: [
                                                                        (
                                                                            Ident {
                                                                                name: "gameID",
                                                                                span: 6273..6279,
                                                                            },
                                                                            Expression(
                                                                                Expression {
                                                                                    kind: Identifier(
                                                                                        Ident {
                                                                                            name: "gameID",
                                                                                            span: 6281..6287,
                                                                                        },
                                                                                    ),
                                                                                    span: 6281..6287,
                                                                                },
                                                                            ),
                                                                        ),
                                                                    ],
                                                                    value_fields: Some(
                                                                        [
                                                                            (
                                                                                Ident {
                                                                                    name: "p",
                                                                                    span: 6291..6292,
                                                                                },
                                                                                Expression(
                                                                                    Expression {
                                                                                        kind: Identifier(
                                                                                            Ident {
                                                                                                name: "p",
                                                                                                span: 6294..6295,
                                                                                            },
                                                                                        ),
                                                                                        span: 6294..6295,
                                                                                    },
                                                                                ),
                                                                            ),
                                                                        ],
                                                                    ),
                                                                },
                                                            },
                                                        ),
                                                        span: 6255..6296,
                                                    },
                                                    Statement {
                                                        kind: Create(
                                                            CreateStatement {
                                                                fact: FactLiteral {
                                                                    identifier: Ident {
                                                                        name: "GameOver",
                                                                        span: 6324..6332,
                                                                    },
                                                                    key_fields: [
                                                                        (
                                                                            Ident {
                                                                                name: "gameID",
                                                                                span: 6333..6339,
                                                                            },
                                                                            Expression(
                                                                                Expression {
                                                                                    kind: Identifier(
                                                                                        Ident {
                                                                                            name: "gameID",
                                                                                            span: 6341..6347,
                                                                                        },
                                                                                    ),
                                                                                    span: 6341..6347,
                                                                                },
                                                                            ),
                                                                        ),
                                                                    ],
                                                                    value_fields: Some(
                                                                        [],
                                                                    ),
                                                                },
                                                            },
                                                        ),
                                                        span: 6317..6352,
                                                    },
                                                    Statement {
                                                        kind: Emit(
                                                            Expression {
                                                                kind: NamedStruct(
                                                                    NamedStruct {
                                                                        identifier: Ident {
                                                                            name: "GameOver",
                                                                            span: 6378..6386,
                                                                        },
                                                                        fields: [
                                                                            (
                                                                                Ident {
                                                                                    name: "gameID",
                                                                                    span: 6412..6418,
                                                                                },
                                                                                Expression {
                                                                                    kind: Identifier(
                                                                                        Ident {
                                                                                            name: "gameID",
                                                                                            span: 6420..6426,
                                                                                        },
                                                                                    ),
                                                                                    span: 6420..6426,
                                                                                },
                                                                            ),
                                                                            (
                                                                                Ident {
                                                                                    name: "winner",
                                                                                    span: 6452..6458,
                                                                                },
                                                                                Expression {
                                                                                    kind: Identifier(
                                                                                        Ident {
                                                                                            name: "player",
                                                                                            span: 6460..6466,
                                                                                        },
                                                                                    ),
                                                                                    span: 6460..6466,
                                                                                },
                                                                            ),
                                                                            (
                                                                                Ident {
                                                                                    name: "p",
                                                                                    span: 6492..6493,
                                                                                },
                                                                                Expression {
                                                                                    kind: Identifier(
                                                                                        Ident {
                                                                                            name: "p",
                                                                                            span: 6495..6496,
                                                                                        },
                                                                                    ),
                                                                                    span: 6495..6496,
                                                                                },
                                                                            ),
                                                                        ],
                                                                        sources: [],
                                                                    },
                                                                ),
                                                                span: 6378..6519,
                                                            },
                                                        ),
                                                        span: 6373..6536,
                                                    },
                                                ],
                                            ),
                                            span: 6157..6537,
                                        },
                                    ],
                                },
                                MatchArm {
                                    pattern: Values(
                                        [
                                            Expression {
                                                kind: Bool(
                                                    false,
                                                ),
                                                span: 6564..6569,
                                            },
                                        ],
                                    ),
                                    statements: [
                                        Statement {
                                            kind: Finish(
                                                [
                                                    Statement {
                                                        kind: Create(
                                                            CreateStatement {
                                                                fact: FactLiteral {
                                                                    identifier: Ident {
                                                                        name: "Field",
                                                                        span: 6627..6632,
                                                                    },
                                                                    key_fields: [
                                                                        (
                                                                            Ident {
                                                                                name: "gameID",
                                                                                span: 6633..6639,
                                                                            },
                                                                            Expression(
                                                                                Expression {
                                                                                    kind: Identifier(
                                                                                        Ident {
                                                                                            name: "gameID",
                                                                                            span: 6641..6647,
                                                                                        },
                                                                                    ),
                                                                                    span: 6641..6647,
                                                                                },
                                                                            ),
                                                                        ),
                                                                        (
                                                                            Ident {
                                                                                name: "x",
                                                                                span: 6649..6650,
                                                                            },
                                                                            Expression(
                                                                                Expression {
                                                                                    kind: Identifier(
                                                                                        Ident {
                                                                                            name: "X",
                                                                                            span: 6652..6653,
                                                                                        },
                                                                                    ),
                                                                                    span: 6652..6653,
                                                                                },
                                                                            ),
                                                                        ),
                                                                        (
                                                                            Ident {
                                                                                name: "y",
                                                                                span: 6655..6656,
                                                                            },
                                                                            Expression(
                                                                                Expression {
                                                                                    kind: Identifier(
                                                                                        Ident {
                                                                                            name: "Y",
                                                                                            span: 6658..6659,
                                                                                        },
                                                                                    ),
                                                                                    span: 6658..6659,
                                                                                },
                                                                            ),
                                                                        ),
                                                                    ],
                                                                    value_fields: Some(
                                                                        [
                                                                            (
                                                                                Ident {
                                                                                    name: "p",
                                                                                    span: 6663..6664,
                                                                                },
                                                                                Expression(
                                                                                    Expression {
                                                                                        kind: Identifier(
                                                                                            Ident {
                                                                                                name: "p",
                                                                                                span: 6666..6667,
                                                                                            },
                                                                                        ),
                                                                                        span: 6666..6667,
                                                                                    },
                                                                                ),
                                                                            ),
                                                                        ],
                                                                    ),
                                                                },
                                                            },
                                                        ),
                                                        span: 6620..6668,
                                                    },
                                                    Statement {
                                                        kind: FunctionCall(
                                                            FunctionCall {
                                                                identifier: Ident {
                                                                    name: "set_next_player",
                                                                    span: 6689..6704,
                                                                },
                                                                arguments: [
                                                                    Expression {
                                                                        kind: Identifier(
                                                                            Ident {
                                                                                name: "gameID",
                                                                                span: 6705..6711,
                                                                            },
                                                                        ),
                                                                        span: 6705..6711,
                                                                    },
                                                                    Expression {
                                                                        kind: Identifier(
                                                                            Ident {
                                                                                name: "op",
                                                                                span: 6713..6715,
                                                                            },
                                                                        ),
                                                                        span: 6713..6715,
                                                                    },
                                                                ],
                                                            },
                                                        ),
                                                        span: 6689..6716,
                                                    },
                                                    Statement {
                                                        kind: Emit(
                                                            Expression {
                                                                kind: NamedStruct(
                                                                    NamedStruct {
                                                                        identifier: Ident {
                                                                            name: "GameUpdate",
                                                                            span: 6742..6752,
                                                                        },
                                                                        fields: [
                                                                            (
                                                                                Ident {
                                                                                    name: "gameID",
                                                                                    span: 6778..6784,
                                                                                },
                                                                                Expression {
                                                                                    kind: Identifier(
                                                                                        Ident {
                                                                                            name: "gameID",
                                                                                            span: 6786..6792,
                                                                                        },
                                                                                    ),
                                                                                    span: 6786..6792,
                                                                                },
                                                                            ),
                                                                            (
                                                                                Ident {
                                                                                    name: "player",
                                                                                    span: 6818..6824,
                                                                                },
                                                                                Expression {
                                                                                    kind: Identifier(
                                                                                        Ident {
                                                                                            name: "player",
                                                                                            span: 6826..6832,
                                                                                        },
                                                                                    ),
                                                                                    span: 6826..6832,
                                                                                },
                                                                            ),
                                                                            (
                                                                                Ident {
                                                                                    name: "p",
                                                                                    span: 6858..6859,
                                                                                },
                                                                                Expression {
                                                                                    kind: Identifier(
                                                                                        Ident {
                                                                                            name: "p",
                                                                                            span: 6861..6862,
                                                                                        },
                                                                                    ),
                                                                                    span: 6861..6862,
                                                                                },
                                                                            ),
                                                                            (
                                                                                Ident {
                                                                                    name: "x",
                                                                                    span: 6888..6889,
                                                                                },
                                                                                Expression {
                                                                                    kind: Identifier(
                                                                                        Ident {
                                                                                            name: "X",
                                                                                            span: 6891..6892,
                                                                                        },
                                                                                    ),
                                                                                    span: 6891..6892,
                                                                                },
                                                                            ),
                                                                            (
                                                                                Ident {
                                                                                    name: "y",
                                                                                    span: 6918..6919,
                                                                                },
                                                                                Expression {
                                                                                    kind: Identifier(
                                                                                        Ident {
                                                                                            name: "Y",
                                                                                            span: 6921..6922,
                                                                                        },
                                                                                    ),
                                                                                    span: 6921..6922,
                                                                                },
                                                                            ),
                                                                        ],
                                                                        sources: [],
                                                                    },
                                                                ),
                                                                span: 6742..6945,
                                                            },
                                                        ),
                                                        span: 6737..6962,
                                                    },
                                                ],
                                            ),
                                            span: 6591..6963,
                                        },
                                    ],
                                },
                            ],
                        },
                    ),
                    span: 6084..6987,
                },
            ],
            recall: [],
            span: 5543..6995,
        },
    ],
    functions: [
        FunctionDefinition {
            identifier: Ident {
                name: "bounds",
                span: 319..325,
            },
            arguments: [
                FieldDefinition {
                    identifier: Ident {
                        name: "v",
                        span: 326..327,
                    },
                    field_type: VType {
                        kind: Int,
                        span: 328..331,
                    },
                },
            ],
            return_type: VType {
                kind: Bool,
                span: 333..337,
            },
            statements: [
                Statement {
                    kind: Return(
                        ReturnStatement {
                            expression: Expression {
                                kind: And(
                                    Expression {
                                        kind: GreaterThanOrEqual(
                                            Expression {
                                                kind: Identifier(
                                                    Ident {
                                                        name: "v",
                                                        span: 351..352,
                                                    },
                                                ),
                                                span: 351..352,
                                            },
                                            Expression {
                                                kind: Int(
                                                    0,
                                                ),
                                                span: 356..357,
                                            },
                                        ),
                                        span: 351..357,
                                    },
                                    Expression {
                                        kind: LessThanOrEqual(
                                            Expression {
                                                kind: Identifier(
                                                    Ident {
                                                        name: "v",
                                                        span: 361..362,
                                                    },
                                                ),
                                                span: 361..362,
                                            },
                                            Expression {
                                                kind: Int(
                                                    2,
                                                ),
                                                span: 366..367,
                                            },
                                        ),
                                        span: 361..367,
                                    },
                                ),
                                span: 351..367,
                            },
                        },
                    ),
                    span: 344..368,
                },
            ],
            span: 310..369,
        },
        FunctionDefinition {
            identifier: Ident {
                name: "game_over",
                span: 4098..4107,
            },
            arguments: [
                FieldDefinition {
                    identifier: Ident {
                        name: "gameID",
                        span: 4108..4114,
                    },
                    field_type: VType {
                        kind: Id,
                        span: 4115..4117,
                    },
                },
                FieldDefinition {
                    identifier: Ident {
                        name: "x",
                        span: 4119..4120,
                    },
                    field_type: VType {
                        kind: Int,
                        span: 4121..4124,
                    },
                },
                FieldDefinition {
                    identifier: Ident {
                        name: "y",
                        span: 4126..4127,
                    },
                    field_type: VType {
                        kind: Int,
                        span: 4128..4131,
                    },
                },
                FieldDefinition {
                    identifier: Ident {
                        name: "p",
                        span: 4133..4134,
                    },
                    field_type: VType {
                        kind: String,
                        span: 4135..4141,
                    },
                },
            ],
            return_type: VType {
                kind: Bool,
                span: 4143..4147,
            },
            statements: [
                Statement {
                    kind: Let(
                        LetStatement {
                            identifier: Ident {
                                name: "f00",
                                span: 4158..4161,
                            },
                            expression: Expression {
                                kind: InternalFunction(
                                    If(
                                        Expression {
                                            kind: And(
                                                Expression {
                                                    kind: Equal(
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "x",
                                                                    span: 4167..4168,
                                                                },
                                                            ),
                                                            span: 4167..4168,
                                                        },
                                                        Expression {
                                                            kind: Int(
                                                                0,
                                                            ),
                                                            span: 4172..4173,
                                                        },
                                                    ),
                                                    span: 4167..4173,
                                                },
                                                Expression {
                                                    kind: Equal(
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "y",
                                                                    span: 4177..4178,
                                                                },
                                                            ),
                                                            span: 4177..4178,
                                                        },
                                                        Expression {
                                                            kind: Int(
                                                                0,
                                                            ),
                                                            span: 4182..4183,
                                                        },
                                                    ),
                                                    span: 4177..4183,
                                                },
                                            ),
                                            span: 4167..4183,
                                        },
                                        Expression {
                                            kind: Block(
                                                [],
                                                Expression {
                                                    kind: Optional(
                                                        Some(
                                                            Expression {
                                                                kind: Identifier(
                                                                    Ident {
                                                                        name: "p",
                                                                        span: 4192..4193,
                                                                    },
                                                                ),
                                                                span: 4192..4193,
                                                            },
                                                        ),
                                                    ),
                                                    span: 4187..4194,
                                                },
                                            ),
                                            span: 4184..4196,
                                        },
                                        Expression {
                                            kind: Block(
                                                [],
                                                Expression {
                                                    kind: InternalFunction(
                                                        Query(
                                                            FactLiteral {
                                                                identifier: Ident {
                                                                    name: "Field",
                                                                    span: 4211..4216,
                                                                },
                                                                key_fields: [
                                                                    (
                                                                        Ident {
                                                                            name: "gameID",
                                                                            span: 4217..4223,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Identifier(
                                                                                    Ident {
                                                                                        name: "gameID",
                                                                                        span: 4225..4231,
                                                                                    },
                                                                                ),
                                                                                span: 4225..4231,
                                                                            },
                                                                        ),
                                                                    ),
                                                                    (
                                                                        Ident {
                                                                            name: "x",
                                                                            span: 4233..4234,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Int(
                                                                                    0,
                                                                                ),
                                                                                span: 4236..4237,
                                                                            },
                                                                        ),
                                                                    ),
                                                                    (
                                                                        Ident {
                                                                            name: "y",
                                                                            span: 4239..4240,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Int(
                                                                                    0,
                                                                                ),
                                                                                span: 4242..4243,
                                                                            },
                                                                        ),
                                                                    ),
                                                                ],
                                                                value_fields: Some(
                                                                    [
                                                                        (
                                                                            Ident {
                                                                                name: "p",
                                                                                span: 4247..4248,
                                                                            },
                                                                            Bind(
                                                                                4250..4251,
                                                                            ),
                                                                        ),
                                                                    ],
                                                                ),
                                                            },
                                                        ),
                                                    ),
                                                    span: 4205..4252,
                                                },
                                            ),
                                            span: 4202..4254,
                                        },
                                    ),
                                ),
                                span: 4164..4254,
                            },
                        },
                    ),
                    span: 4154..4259,
                },
                Statement {
                    kind: Let(
                        LetStatement {
                            identifier: Ident {
                                name: "f10",
                                span: 4263..4266,
                            },
                            expression: Expression {
                                kind: InternalFunction(
                                    If(
                                        Expression {
                                            kind: And(
                                                Expression {
                                                    kind: Equal(
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "x",
                                                                    span: 4272..4273,
                                                                },
                                                            ),
                                                            span: 4272..4273,
                                                        },
                                                        Expression {
                                                            kind: Int(
                                                                1,
                                                            ),
                                                            span: 4277..4278,
                                                        },
                                                    ),
                                                    span: 4272..4278,
                                                },
                                                Expression {
                                                    kind: Equal(
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "y",
                                                                    span: 4282..4283,
                                                                },
                                                            ),
                                                            span: 4282..4283,
                                                        },
                                                        Expression {
                                                            kind: Int(
                                                                0,
                                                            ),
                                                            span: 4287..4288,
                                                        },
                                                    ),
                                                    span: 4282..4288,
                                                },
                                            ),
                                            span: 4272..4288,
                                        },
                                        Expression {
                                            kind: Block(
                                                [],
                                                Expression {
                                                    kind: Optional(
                                                        Some(
                                                            Expression {
                                                                kind: Identifier(
                                                                    Ident {
                                                                        name: "p",
                                                                        span: 4297..4298,
                                                                    },
                                                                ),
                                                                span: 4297..4298,
                                                            },
                                                        ),
                                                    ),
                                                    span: 4292..4299,
                                                },
                                            ),
                                            span: 4289..4301,
                                        },
                                        Expression {
                                            kind: Block(
                                                [],
                                                Expression {
                                                    kind: InternalFunction(
                                                        Query(
                                                            FactLiteral {
                                                                identifier: Ident {
                                                                    name: "Field",
                                                                    span: 4316..4321,
                                                                },
                                                                key_fields: [
                                                                    (
                                                                        Ident {
                                                                            name: "gameID",
                                                                            span: 4322..4328,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Identifier(
                                                                                    Ident {
                                                                                        name: "gameID",
                                                                                        span: 4330..4336,
                                                                                    },
                                                                                ),
                                                                                span: 4330..4336,
                                                                            },
                                                                        ),
                                                                    ),
                                                                    (
                                                                        Ident {
                                                                            name: "x",
                                                                            span: 4338..4339,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Int(
                                                                                    1,
                                                                                ),
                                                                                span: 4341..4342,
                                                                            },
                                                                        ),
                                                                    ),
                                                                    (
                                                                        Ident {
                                                                            name: "y",
                                                                            span: 4344..4345,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Int(
                                                                                    0,
                                                                                ),
                                                                                span: 4347..4348,
                                                                            },
                                                                        ),
                                                                    ),
                                                                ],
                                                                value_fields: Some(
                                                                    [
                                                                        (
                                                                            Ident {
                                                                                name: "p",
                                                                                span: 4352..4353,
                                                                            },
                                                                            Bind(
                                                                                4355..4356,
                                                                            ),
                                                                        ),
                                                                    ],
                                                                ),
                                                            },
                                                        ),
                                                    ),
                                                    span: 4310..4357,
                                                },
                                            ),
                                            span: 4307..4359,
                                        },
                                    ),
                                ),
                                span: 4269..4359,
                            },
                        },
                    ),
                    span: 4259..4364,
                },
                Statement {
                    kind: Let(
                        LetStatement {
                            identifier: Ident {
                                name: "f20",
                                span: 4368..4371,
                            },
                            expression: Expression {
                                kind: InternalFunction(
                                    If(
                                        Expression {
                                            kind: And(
                                                Expression {
                                                    kind: Equal(
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "x",
                                                                    span: 4377..4378,
                                                                },
                                                            ),
                                                            span: 4377..4378,
                                                        },
                                                        Expression {
                                                            kind: Int(
                                                                2,
                                                            ),
                                                            span: 4382..4383,
                                                        },
                                                    ),
                                                    span: 4377..4383,
                                                },
                                                Expression {
                                                    kind: Equal(
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "y",
                                                                    span: 4387..4388,
                                                                },
                                                            ),
                                                            span: 4387..4388,
                                                        },
                                                        Expression {
                                                            kind: Int(
                                                                0,
                                                            ),
                                                            span: 4392..4393,
                                                        },
                                                    ),
                                                    span: 4387..4393,
                                                },
                                            ),
                                            span: 4377..4393,
                                        },
                                        Expression {
                                            kind: Block(
                                                [],
                                                Expression {
                                                    kind: Optional(
                                                        Some(
                                                            Expression {
                                                                kind: Identifier(
                                                                    Ident {
                                                                        name: "p",
                                                                        span: 4402..4403,
                                                                    },
                                                                ),
                                                                span: 4402..4403,
                                                            },
                                                        ),
                                                    ),
                                                    span: 4397..4404,
                                                },
                                            ),
                                            span: 4394..4406,
                                        },
                                        Expression {
                                            kind: Block(
                                                [],
                                                Expression {
                                                    kind: InternalFunction(
                                                        Query(
                                                            FactLiteral {
                                                                identifier: Ident {
                                                                    name: "Field",
                                                                    span: 4421..4426,
                                                                },
                                                                key_fields: [
                                                                    (
                                                                        Ident {
                                                                            name: "gameID",
                                                                            span: 4427..4433,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Identifier(
                                                                                    Ident {
                                                                                        name: "gameID",
                                                                                        span: 4435..4441,
                                                                                    },
                                                                                ),
                                                                                span: 4435..4441,
                                                                            },
                                                                        ),
                                                                    ),
                                                                    (
                                                                        Ident {
                                                                            name: "x",
                                                                            span: 4443..4444,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Int(
                                                                                    2,
                                                                                ),
                                                                                span: 4446..4447,
                                                                            },
                                                                        ),
                                                                    ),
                                                                    (
                                                                        Ident {
                                                                            name: "y",
                                                                            span: 4449..4450,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Int(
                                                                                    0,
                                                                                ),
                                                                                span: 4452..4453,
                                                                            },
                                                                        ),
                                                                    ),
                                                                ],
                                                                value_fields: Some(
                                                                    [
                                                                        (
                                                                            Ident {
                                                                                name: "p",
                                                                                span: 4457..4458,
                                                                            },
                                                                            Bind(
                                                                                4460..4461,
                                                                            ),
                                                                        ),
                                                                    ],
                                                                ),
                                                            },
                                                        ),
                                                    ),
                                                    span: 4415..4462,
                                                },
                                            ),
                                            span: 4412..4464,
                                        },
                                    ),
                                ),
                                span: 4374..4464,
                            },
                        },
                    ),
                    span: 4364..4469,
                },
                Statement {
                    kind: Let(
                        LetStatement {
                            identifier: Ident {
                                name: "f01",
                                span: 4473..4476,
                            },
                            expression: Expression {
                                kind: InternalFunction(
                                    If(
                                        Expression {
                                            kind: And(
                                                Expression {
                                                    kind: Equal(
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "x",
                                                                    span: 4482..4483,
                                                                },
                                                            ),
                                                            span: 4482..4483,
                                                        },
                                                        Expression {
                                                            kind: Int(
                                                                0,
                                                            ),
                                                            span: 4487..4488,
                                                        },
                                                    ),
                                                    span: 4482..4488,
                                                },
                                                Expression {
                                                    kind: Equal(
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "y",
                                                                    span: 4492..4493,
                                                                },
                                                            ),
                                                            span: 4492..4493,
                                                        },
                                                        Expression {
                                                            kind: Int(
                                                                1,
                                                            ),
                                                            span: 4497..4498,
                                                        },
                                                    ),
                                                    span: 4492..4498,
                                                },
                                            ),
                                            span: 4482..4498,
                                        },
                                        Expression {
                                            kind: Block(
                                                [],
                                                Expression {
                                                    kind: Optional(
                                                        Some(
                                                            Expression {
                                                                kind: Identifier(
                                                                    Ident {
                                                                        name: "p",
                                                                        span: 4507..4508,
                                                                    },
                                                                ),
                                                                span: 4507..4508,
                                                            },
                                                        ),
                                                    ),
                                                    span: 4502..4509,
                                                },
                                            ),
                                            span: 4499..4511,
                                        },
                                        Expression {
                                            kind: Block(
                                                [],
                                                Expression {
                                                    kind: InternalFunction(
                                                        Query(
                                                            FactLiteral {
                                                                identifier: Ident {
                                                                    name: "Field",
                                                                    span: 4526..4531,
                                                                },
                                                                key_fields: [
                                                                    (
                                                                        Ident {
                                                                            name: "gameID",
                                                                            span: 4532..4538,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Identifier(
                                                                                    Ident {
                                                                                        name: "gameID",
                                                                                        span: 4540..4546,
                                                                                    },
                                                                                ),
                                                                                span: 4540..4546,
                                                                            },
                                                                        ),
                                                                    ),
                                                                    (
                                                                        Ident {
                                                                            name: "x",
                                                                            span: 4548..4549,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Int(
                                                                                    0,
                                                                                ),
                                                                                span: 4551..4552,
                                                                            },
                                                                        ),
                                                                    ),
                                                                    (
                                                                        Ident {
                                                                            name: "y",
                                                                            span: 4554..4555,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Int(
                                                                                    1,
                                                                                ),
                                                                                span: 4557..4558,
                                                                            },
                                                                        ),
                                                                    ),
                                                                ],
                                                                value_fields: Some(
                                                                    [
                                                                        (
                                                                            Ident {
                                                                                name: "p",
                                                                                span: 4562..4563,
                                                                            },
                                                                            Bind(
                                                                                4565..4566,
                                                                            ),
                                                                        ),
                                                                    ],
                                                                ),
                                                            },
                                                        ),
                                                    ),
                                                    span: 4520..4567,
                                                },
                                            ),
                                            span: 4517..4569,
                                        },
                                    ),
                                ),
                                span: 4479..4569,
                            },
                        },
                    ),
                    span: 4469..4574,
                },
                Statement {
                    kind: Let(
                        LetStatement {
                            identifier: Ident {
                                name: "f11",
                                span: 4578..4581,
                            },
                            expression: Expression {
                                kind: InternalFunction(
                                    If(
                                        Expression {
                                            kind: And(
                                                Expression {
                                                    kind: Equal(
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "x",
                                                                    span: 4587..4588,
                                                                },
                                                            ),
                                                            span: 4587..4588,
                                                        },
                                                        Expression {
                                                            kind: Int(
                                                                1,
                                                            ),
                                                            span: 4592..4593,
                                                        },
                                                    ),
                                                    span: 4587..4593,
                                                },
                                                Expression {
                                                    kind: Equal(
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "y",
                                                                    span: 4597..4598,
                                                                },
                                                            ),
                                                            span: 4597..4598,
                                                        },
                                                        Expression {
                                                            kind: Int(
                                                                1,
                                                            ),
                                                            span: 4602..4603,
                                                        },
                                                    ),
                                                    span: 4597..4603,
                                                },
                                            ),
                                            span: 4587..4603,
                                        },
                                        Expression {
                                            kind: Block(
                                                [],
                                                Expression {
                                                    kind: Optional(
                                                        Some(
                                                            Expression {
                                                                kind: Identifier(
                                                                    Ident {
                                                                        name: "p",
                                                                        span: 4612..4613,
                                                                    },
                                                                ),
                                                                span: 4612..4613,
                                                            },
                                                        ),
                                                    ),
                                                    span: 4607..4614,
                                                },
                                            ),
                                            span: 4604..4616,
                                        },
                                        Expression {
                                            kind: Block(
                                                [],
                                                Expression {
                                                    kind: InternalFunction(
                                                        Query(
                                                            FactLiteral {
                                                                identifier: Ident {
                                                                    name: "Field",
                                                                    span: 4631..4636,
                                                                },
                                                                key_fields: [
                                                                    (
                                                                        Ident {
                                                                            name: "gameID",
                                                                            span: 4637..4643,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Identifier(
                                                                                    Ident {
                                                                                        name: "gameID",
                                                                                        span: 4645..4651,
                                                                                    },
                                                                                ),
                                                                                span: 4645..4651,
                                                                            },
                                                                        ),
                                                                    ),
                                                                    (
                                                                        Ident {
                                                                            name: "x",
                                                                            span: 4653..4654,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Int(
                                                                                    1,
                                                                                ),
                                                                                span: 4656..4657,
                                                                            },
                                                                        ),
                                                                    ),
                                                                    (
                                                                        Ident {
                                                                            name: "y",
                                                                            span: 4659..4660,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Int(
                                                                                    1,
                                                                                ),
                                                                                span: 4662..4663,
                                                                            },
                                                                        ),
                                                                    ),
                                                                ],
                                                                value_fields: Some(
                                                                    [
                                                                        (
                                                                            Ident {
                                                                                name: "p",
                                                                                span: 4667..4668,
                                                                            },
                                                                            Bind(
                                                                                4670..4671,
                                                                            ),
                                                                        ),
                                                                    ],
                                                                ),
                                                            },
                                                        ),
                                                    ),
                                                    span: 4625..4672,
                                                },
                                            ),
                                            span: 4622..4674,
                                        },
                                    ),
                                ),
                                span: 4584..4674,
                            },
                        },
                    ),
                    span: 4574..4679,
                },
                Statement {
                    kind: Let(
                        LetStatement {
                            identifier: Ident {
                                name: "f21",
                                span: 4683..4686,
                            },
                            expression: Expression {
                                kind: InternalFunction(
                                    If(
                                        Expression {
                                            kind: And(
                                                Expression {
                                                    kind: Equal(
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "x",
                                                                    span: 4692..4693,
                                                                },
                                                            ),
                                                            span: 4692..4693,
                                                        },
                                                        Expression {
                                                            kind: Int(
                                                                2,
                                                            ),
                                                            span: 4697..4698,
                                                        },
                                                    ),
                                                    span: 4692..4698,
                                                },
                                                Expression {
                                                    kind: Equal(
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "y",
                                                                    span: 4702..4703,
                                                                },
                                                            ),
                                                            span: 4702..4703,
                                                        },
                                                        Expression {
                                                            kind: Int(
                                                                1,
                                                            ),
                                                            span: 4707..4708,
                                                        },
                                                    ),
                                                    span: 4702..4708,
                                                },
                                            ),
                                            span: 4692..4708,
                                        },
                                        Expression {
                                            kind: Block(
                                                [],
                                                Expression {
                                                    kind: Optional(
                                                        Some(
                                                            Expression {
                                                                kind: Identifier(
                                                                    Ident {
                                                                        name: "p",
                                                                        span: 4717..4718,
                                                                    },
                                                                ),
                                                                span: 4717..4718,
                                                            },
                                                        ),
                                                    ),
                                                    span: 4712..4719,
                                                },
                                            ),
                                            span: 4709..4721,
                                        },
                                        Expression {
                                            kind: Block(
                                                [],
                                                Expression {
                                                    kind: InternalFunction(
                                                        Query(
                                                            FactLiteral {
                                                                identifier: Ident {
                                                                    name: "Field",
                                                                    span: 4736..4741,
                                                                },
                                                                key_fields: [
                                                                    (
                                                                        Ident {
                                                                            name: "gameID",
                                                                            span: 4742..4748,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Identifier(
                                                                                    Ident {
                                                                                        name: "gameID",
                                                                                        span: 4750..4756,
                                                                                    },
                                                                                ),
                                                                                span: 4750..4756,
                                                                            },
                                                                        ),
                                                                    ),
                                                                    (
                                                                        Ident {
                                                                            name: "x",
                                                                            span: 4758..4759,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Int(
                                                                                    2,
                                                                                ),
                                                                                span: 4761..4762,
                                                                            },
                                                                        ),
                                                                    ),
                                                                    (
                                                                        Ident {
                                                                            name: "y",
                                                                            span: 4764..4765,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Int(
                                                                                    1,
                                                                                ),
                                                                                span: 4767..4768,
                                                                            },
                                                                        ),
                                                                    ),
                                                                ],
                                                                value_fields: Some(
                                                                    [
                                                                        (
                                                                            Ident {
                                                                                name: "p",
                                                                                span: 4772..4773,
                                                                            },
                                                                            Bind(
                                                                                4775..4776,
                                                                            ),
                                                                        ),
                                                                    ],
                                                                ),
                                                            },
                                                        ),
                                                    ),
                                                    span: 4730..4777,
                                                },
                                            ),
                                            span: 4727..4779,
                                        },
                                    ),
                                ),
                                span: 4689..4779,
                            },
                        },
                    ),
                    span: 4679..4784,
                },
                Statement {
                    kind: Let(
                        LetStatement {
                            identifier: Ident {
                                name: "f02",
                                span: 4788..4791,
                            },
                            expression: Expression {
                                kind: InternalFunction(
                                    If(
                                        Expression {
                                            kind: And(
                                                Expression {
                                                    kind: Equal(
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "x",
                                                                    span: 4797..4798,
                                                                },
                                                            ),
                                                            span: 4797..4798,
                                                        },
                                                        Expression {
                                                            kind: Int(
                                                                0,
                                                            ),
                                                            span: 4802..4803,
                                                        },
                                                    ),
                                                    span: 4797..4803,
                                                },
                                                Expression {
                                                    kind: Equal(
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "y",
                                                                    span: 4807..4808,
                                                                },
                                                            ),
                                                            span: 4807..4808,
                                                        },
                                                        Expression {
                                                            kind: Int(
                                                                2,
                                                            ),
                                                            span: 4812..4813,
                                                        },
                                                    ),
                                                    span: 4807..4813,
                                                },
                                            ),
                                            span: 4797..4813,
                                        },
                                        Expression {
                                            kind: Block(
                                                [],
                                                Expression {
                                                    kind: Optional(
                                                        Some(
                                                            Expression {
                                                                kind: Identifier(
                                                                    Ident {
                                                                        name: "p",
                                                                        span: 4822..4823,
                                                                    },
                                                                ),
                                                                span: 4822..4823,
                                                            },
                                                        ),
                                                    ),
                                                    span: 4817..4824,
                                                },
                                            ),
                                            span: 4814..4826,
                                        },
                                        Expression {
                                            kind: Block(
                                                [],
                                                Expression {
                                                    kind: InternalFunction(
                                                        Query(
                                                            FactLiteral {
                                                                identifier: Ident {
                                                                    name: "Field",
                                                                    span: 4841..4846,
                                                                },
                                                                key_fields: [
                                                                    (
                                                                        Ident {
                                                                            name: "gameID",
                                                                            span: 4847..4853,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Identifier(
                                                                                    Ident {
                                                                                        name: "gameID",
                                                                                        span: 4855..4861,
                                                                                    },
                                                                                ),
                                                                                span: 4855..4861,
                                                                            },
                                                                        ),
                                                                    ),
                                                                    (
                                                                        Ident {
                                                                            name: "x",
                                                                            span: 4863..4864,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Int(
                                                                                    0,
                                                                                ),
                                                                                span: 4866..4867,
                                                                            },
                                                                        ),
                                                                    ),
                                                                    (
                                                                        Ident {
                                                                            name: "y",
                                                                            span: 4869..4870,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Int(
                                                                                    2,
                                                                                ),
                                                                                span: 4872..4873,
                                                                            },
                                                                        ),
                                                                    ),
                                                                ],
                                                                value_fields: Some(
                                                                    [
                                                                        (
                                                                            Ident {
                                                                                name: "p",
                                                                                span: 4877..4878,
                                                                            },
                                                                            Bind(
                                                                                4880..4881,
                                                                            ),
                                                                        ),
                                                                    ],
                                                                ),
                                                            },
                                                        ),
                                                    ),
                                                    span: 4835..4882,
                                                },
                                            ),
                                            span: 4832..4884,
                                        },
                                    ),
                                ),
                                span: 4794..4884,
                            },
                        },
                    ),
                    span: 4784..4889,
                },
                Statement {
                    kind: Let(
                        LetStatement {
                            identifier: Ident {
                                name: "f12",
                                span: 4893..4896,
                            },
                            expression: Expression {
                                kind: InternalFunction(
                                    If(
                                        Expression {
                                            kind: And(
                                                Expression {
                                                    kind: Equal(
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "x",
                                                                    span: 4902..4903,
                                                                },
                                                            ),
                                                            span: 4902..4903,
                                                        },
                                                        Expression {
                                                            kind: Int(
                                                                1,
                                                            ),
                                                            span: 4907..4908,
                                                        },
                                                    ),
                                                    span: 4902..4908,
                                                },
                                                Expression {
                                                    kind: Equal(
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "y",
                                                                    span: 4912..4913,
                                                                },
                                                            ),
                                                            span: 4912..4913,
                                                        },
                                                        Expression {
                                                            kind: Int(
                                                                2,
                                                            ),
                                                            span: 4917..4918,
                                                        },
                                                    ),
                                                    span: 4912..4918,
                                                },
                                            ),
                                            span: 4902..4918,
                                        },
                                        Expression {
                                            kind: Block(
                                                [],
                                                Expression {
                                                    kind: Optional(
                                                        Some(
                                                            Expression {
                                                                kind: Identifier(
                                                                    Ident {
                                                                        name: "p",
                                                                        span: 4927..4928,
                                                                    },
                                                                ),
                                                                span: 4927..4928,
                                                            },
                                                        ),
                                                    ),
                                                    span: 4922..4929,
                                                },
                                            ),
                                            span: 4919..4931,
                                        },
                                        Expression {
                                            kind: Block(
                                                [],
                                                Expression {
                                                    kind: InternalFunction(
                                                        Query(
                                                            FactLiteral {
                                                                identifier: Ident {
                                                                    name: "Field",
                                                                    span: 4946..4951,
                                                                },
                                                                key_fields: [
                                                                    (
                                                                        Ident {
                                                                            name: "gameID",
                                                                            span: 4952..4958,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Identifier(
                                                                                    Ident {
                                                                                        name: "gameID",
                                                                                        span: 4960..4966,
                                                                                    },
                                                                                ),
                                                                                span: 4960..4966,
                                                                            },
                                                                        ),
                                                                    ),
                                                                    (
                                                                        Ident {
                                                                            name: "x",
                                                                            span: 4968..4969,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Int(
                                                                                    1,
                                                                                ),
                                                                                span: 4971..4972,
                                                                            },
                                                                        ),
                                                                    ),
                                                                    (
                                                                        Ident {
                                                                            name: "y",
                                                                            span: 4974..4975,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Int(
                                                                                    2,
                                                                                ),
                                                                                span: 4977..4978,
                                                                            },
                                                                        ),
                                                                    ),
                                                                ],
                                                                value_fields: Some(
                                                                    [
                                                                        (
                                                                            Ident {
                                                                                name: "p",
                                                                                span: 4982..4983,
                                                                            },
                                                                            Bind(
                                                                                4985..4986,
                                                                            ),
                                                                        ),
                                                                    ],
                                                                ),
                                                            },
                                                        ),
                                                    ),
                                                    span: 4940..4987,
                                                },
                                            ),
                                            span: 4937..4989,
                                        },
                                    ),
                                ),
                                span: 4899..4989,
                            },
                        },
                    ),
                    span: 4889..4994,
                },
                Statement {
                    kind: Let(
                        LetStatement {
                            identifier: Ident {
                                name: "f22",
                                span: 4998..5001,
                            },
                            expression: Expression {
                                kind: InternalFunction(
                                    If(
                                        Expression {
                                            kind: And(
                                                Expression {
                                                    kind: Equal(
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "x",
                                                                    span: 5007..5008,
                                                                },
                                                            ),
                                                            span: 5007..5008,
                                                        },
                                                        Expression {
                                                            kind: Int(
                                                                2,
                                                            ),
                                                            span: 5012..5013,
                                                        },
                                                    ),
                                                    span: 5007..5013,
                                                },
                                                Expression {
                                                    kind: Equal(
                                                        Expression {
                                                            kind: Identifier(
                                                                Ident {
                                                                    name: "y",
                                                                    span: 5017..5018,
                                                                },
                                                            ),
                                                            span: 5017..5018,
                                                        },
                                                        Expression {
                                                            kind: Int(
                                                                2,
                                                            ),
                                                            span: 5022..5023,
                                                        },
                                                    ),
                                                    span: 5017..5023,
                                                },
                                            ),
                                            span: 5007..5023,
                                        },
                                        Expression {
                                            kind: Block(
                                                [],
                                                Expression {
                                                    kind: Optional(
                                                        Some(
                                                            Expression {
                                                                kind: Identifier(
                                                                    Ident {
                                                                        name: "p",
                                                                        span: 5032..5033,
                                                                    },
                                                                ),
                                                                span: 5032..5033,
                                                            },
                                                        ),
                                                    ),
                                                    span: 5027..5034,
                                                },
                                            ),
                                            span: 5024..5036,
                                        },
                                        Expression {
                                            kind: Block(
                                                [],
                                                Expression {
                                                    kind: InternalFunction(
                                                        Query(
                                                            FactLiteral {
                                                                identifier: Ident {
                                                                    name: "Field",
                                                                    span: 5051..5056,
                                                                },
                                                                key_fields: [
                                                                    (
                                                                        Ident {
                                                                            name: "gameID",
                                                                            span: 5057..5063,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Identifier(
                                                                                    Ident {
                                                                                        name: "gameID",
                                                                                        span: 5065..5071,
                                                                                    },
                                                                                ),
                                                                                span: 5065..5071,
                                                                            },
                                                                        ),
                                                                    ),
                                                                    (
                                                                        Ident {
                                                                            name: "x",
                                                                            span: 5073..5074,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Int(
                                                                                    2,
                                                                                ),
                                                                                span: 5076..5077,
                                                                            },
                                                                        ),
                                                                    ),
                                                                    (
                                                                        Ident {
                                                                            name: "y",
                                                                            span: 5079..5080,
                                                                        },
                                                                        Expression(
                                                                            Expression {
                                                                                kind: Int(
                                                                                    2,
                                                                                ),
                                                                                span: 5082..5083,
                                                                            },
                                                                        ),
                                                                    ),
                                                                ],
                                                                value_fields: Some(
                                                                    [
                                                                        (
                                                                            Ident {
                                                                                name: "p",
                                                                                span: 5087..5088,
                                                                            },
                                                                            Bind(
                                                                                5090..5091,
                                                                            ),
                                                                        ),
                                                                    ],
                                                                ),
                                                            },
                                                        ),
                                                    ),
                                                    span: 5045..5092,
                                                },
                                            ),
                                            span: 5042..5094,
                                        },
                                    ),
                                ),
                                span: 5004..5094,
                            },
                        },
                    ),
                    span: 4994..5099,
                },
                Statement {
                    kind: Return(
                        ReturnStatement {
                            expression: Expression {
                                kind: Or(
                                    Expression {
                                        kind: Or(
                                            Expression {
                                                kind: Or(
                                                    Expression {
                                                        kind: Or(
                                                            Expression {
                                                                kind: Or(
                                                                    Expression {
                                                                        kind: Or(
                                                                            Expression {
                                                                                kind: Or(
                                                                                    Expression {
                                                                                        kind: And(
                                                                                            Expression {
                                                                                                kind: And(
                                                                                                    Expression {
                                                                                                        kind: Is(
                                                                                                            Expression {
                                                                                                                kind: Identifier(
                                                                                                                    Ident {
                                                                                                                        name: "f00",
                                                                                                                        span: 5107..5110,
                                                                                                                    },
                                                                                                                ),
                                                                                                                span: 5107..5110,
                                                                                                            },
                                                                                                            true,
                                                                                                        ),
                                                                                                        span: 5107..5118,
                                                                                                    },
                                                                                                    Expression {
                                                                                                        kind: Equal(
                                                                                                            Expression {
                                                                                                                kind: Identifier(
                                                                                                                    Ident {
                                                                                                                        name: "f00",
                                                                                                                        span: 5122..5125,
                                                                                                                    },
                                                                                                                ),
                                                                                                                span: 5122..5125,
                                                                                                            },
                                                                                                            Expression {
                                                                                                                kind: Identifier(
                                                                                                                    Ident {
                                                                                                                        name: "f10",
                                                                                                                        span: 5129..5132,
                                                                                                                    },
                                                                                                                ),
                                                                                                                span: 5129..5132,
                                                                                                            },
                                                                                                        ),
                                                                                                        span: 5122..5132,
                                                                                                    },
                                                                                                ),
                                                                                                span: 5107..5132,
                                                                                            },
                                                                                            Expression {
                                                                                                kind: Equal(
                                                                                                    Expression {
                                                                                                        kind: Identifier(
                                                                                                            Ident {
                                                                                                                name: "f10",
                                                                                                                span: 5136..5139,
                                                                                                            },
                                                                                                        ),
                                                                                                        span: 5136..5139,
                                                                                                    },
                                                                                                    Expression {
                                                                                                        kind: Identifier(
                                                                                                            Ident {
                                                                                                                name: "f20",
                                                                                                                span: 5143..5146,
                                                                                                            },
                                                                                                        ),
                                                                                                        span: 5143..5146,
                                                                                                    },
                                                                                                ),
                                                                                                span: 5136..5146,
                                                                                            },
                                                                                        ),
                                                                                        span: 5107..5146,
                                                                                    },
                                                                                    Expression {
                                                                                        kind: And(
                                                                                            Expression {
                                                                                                kind: And(
                                                                                                    Expression {
                                                                                                        kind: Is(
                                                                                                            Expression {
                                                                                                                kind: Identifier(
                                                                                                                    Ident {
                                                                                                                        name: "f01",
                                                                                                                        span: 5163..5166,
                                                                                                                    },
                                                                                                                ),
                                                                                                                span: 5163..5166,
                                                                                                            },
                                                                                                            true,
                                                                                                        ),
                                                                                                        span: 5163..5174,
                                                                                                    },
                                                                                                    Expression {
                                                                                                        kind: Equal(
                                                                                                            Expression {
                                                                                                                kind: Identifier(
                                                                                                                    Ident {
                                                                                                                        name: "f01",
                                                                                                                        span: 5178..5181,
                                                                                                                    },
                                                                                                                ),
                                                                                                                span: 5178..5181,
                                                                                                            },
                                                                                                            Expression {
                                                                                                                kind: Identifier(
                                                                                                                    Ident {
                                                                                                                        name: "f11",
                                                                                                                        span: 5185..5188,
                                                                                                                    },
                                                                                                                ),
                                                                                                                span: 5185..5188,
                                                                                                            },
                                                                                                        ),
                                                                                                        span: 5178..5188,
                                                                                                    },
                                                                                                ),
                                                                                                span: 5163..5188,
                                                                                            },
                                                                                            Expression {
                                                                                                kind: Equal(
                                                                                                    Expression {
                                                                                                        kind: Identifier(
                                                                                                            Ident {
                                                                                                                name: "f11",
                                                                                                                span: 5192..5195,
                                                                                                            },
                                                                                                        ),
                                                                                                        span: 5192..5195,
                                                                                                    },
                                                                                                    Expression {
                                                                                                        kind: Identifier(
                                                                                                            Ident {
                                                                                                                name: "f21",
                                                                                                                span: 5199..5202,
                                                                                                            },
                                                                                                        ),
                                                                                                        span: 5199..5202,
                                                                                                    },
                                                                                                ),
                                                                                                span: 5192..5202,
                                                                                            },
                                                                                        ),
                                                                                        span: 5163..5202,
                                                                                    },
                                                                                ),
                                                                                span: 5107..5202,
                                                                            },
                                                                            Expression {
                                                                                kind: And(
                                                                                    Expression {
                                                                                        kind: And(
                                                                                            Expression {
                                                                                                kind: Is(
                                                                                                    Expression {
                                                                                                        kind: Identifier(
                                                                                                            Ident {
                                                                                                                name: "f01",
                                                                                                                span: 5219..5222,
                                                                                                            },
                                                                                                        ),
                                                                                                        span: 5219..5222,
                                                                                                    },
                                                                                                    true,
                                                                                                ),
                                                                                                span: 5219..5230,
                                                                                            },
                                                                                            Expression {
                                                                                                kind: Equal(
                                                                                                    Expression {
                                                                                                        kind: Identifier(
                                                                                                            Ident {
                                                                                                                name: "f02",
                                                                                                                span: 5234..5237,
                                                                                                            },
                                                                                                        ),
                                                                                                        span: 5234..5237,
                                                                                                    },
                                                                                                    Expression {
                                                                                                        kind: Identifier(
                                                                                                            Ident {
                                                                                                                name: "f12",
                                                                                                                span: 5241..5244,
                                                                                                            },
                                                                                                        ),
                                                                                                        span: 5241..5244,
                                                                                                    },
                                                                                                ),
                                                                                                span: 5234..5244,
                                                                                            },
                                                                                        ),
                                                                                        span: 5219..5244,
                                                                                    },
                                                                                    Expression {
                                                                                        kind: Equal(
                                                                                            Expression {
                                                                                                kind: Identifier(
                                                                                                    Ident {
                                                                                                        name: "f12",
                                                                                                        span: 5248..5251,
                                                                                                    },
                                                                                                ),
                                                                                                span: 5248..5251,
                                                                                            },
                                                                                            Expression {
                                                                                                kind: Identifier(
                                                                                                    Ident {
                                                                                                        name: "f22",
                                                                                                        span: 5255..5258,
                                                                                                    },
                                                                                                ),
                                                                                                span: 5255..5258,
                                                                                            },
                                                                                        ),
                                                                                        span: 5248..5258,
                                                                                    },
                                                                                ),
                                                                                span: 5219..5258,
                                                                            },
                                                                        ),
                                                                        span: 5107..5258,
                                                                    },
                                                                    Expression {
                                                                        kind: And(
                                                                            Expression {
                                                                                kind: And(
                                                                                    Expression {
                                                                                        kind: Is(
                                                                                            Expression {
                                                                                                kind: Identifier(
                                                                                                    Ident {
                                                                                                        name: "f00",
                                                                                                        span: 5275..5278,
                                                                                                    },
                                                                                                ),
                                                                                                span: 5275..5278,
                                                                                            },
                                                                                            true,
                                                                                        ),
                                                                                        span: 5275..5286,
                                                                                    },
                                                                                    Expression {
                                                                                        kind: Equal(
                                                                                            Expression {
                                                                                                kind: Identifier(
                                                                                                    Ident {
                                                                                                        name: "f00",
                                                                                                        span: 5290..5293,
                                                                                                    },
                                                                                                ),
                                                                                                span: 5290..5293,
                                                                                            },
                                                                                            Expression {
                                                                                                kind: Identifier(
                                                                                                    Ident {
                                                                                                        name: "f01",
                                                                                                        span: 5297..5300,
                                                                                                    },
                                                                                                ),
                                                                                                span: 5297..5300,
                                                                                            },
                                                                                        ),
                                                                                        span: 5290..5300,
                                                                                    },
                                                                                ),
                                                                                span: 5275..5300,
                                                                            },
                                                                            Expression {
                                                                                kind: Equal(
                                                                                    Expression {
                                                                                        kind: Identifier(
                                                                                            Ident {
                                                                                                name: "f01",
                                                                                                span: 5304..5307,
                                                                                            },
                                                                                        ),
                                                                                        span: 5304..5307,
                                                                                    },
                                                                                    Expression {
                                                                                        kind: Identifier(
                                                                                            Ident {
                                                                                                name: "f02",
                                                                                                span: 5311..5314,
                                                                                            },
                                                                                        ),
                                                                                        span: 5311..5314,
                                                                                    },
                                                                                ),
                                                                                span: 5304..5314,
                                                                            },
                                                                        ),
                                                                        span: 5275..5314,
                                                                    },
                                                                ),
                                                                span: 5107..5314,
                                                            },
                                                            Expression {
                                                                kind: And(
                                                                    Expression {
                                                                        kind: And(
                                                                            Expression {
                                                                                kind: Is(
                                                                                    Expression {
                                                                                        kind: Identifier(
                                                                                            Ident {
                                                                                                name: "f10",
                                                                                                span: 5331..5334,
                                                                                            },
                                                                                        ),
                                                                                        span: 5331..5334,
                                                                                    },
                                                                                    true,
                                                                                ),
                                                                                span: 5331..5342,
                                                                            },
                                                                            Expression {
                                                                                kind: Equal(
                                                                                    Expression {
                                                                                        kind: Identifier(
                                                                                            Ident {
                                                                                                name: "f10",
                                                                                                span: 5346..5349,
                                                                                            },
                                                                                        ),
                                                                                        span: 5346..5349,
                                                                                    },
                                                                                    Expression {
                                                                                        kind: Identifier(
                                                                                            Ident {
                                                                                                name: "f11",
                                                                                                span: 5353..5356,
                                                                                            },
                                                                                        ),
                                                                                        span: 5353..5356,
                                                                                    },
                                                                                ),
                                                                                span: 5346..5356,
                                                                            },
                                                                        ),
                                                                        span: 5331..5356,
                                                                    },
                                                                    Expression {
                                                                        kind: Equal(
                                                                            Expression {
                                                                                kind: Identifier(
                                                                                    Ident {
                                                                                        name: "f11",
                                                                                        span: 5360..5363,
                                                                                    },
                                                                                ),
                                                                                span: 5360..5363,
                                                                            },
                                                                            Expression {
                                                                                kind: Identifier(
                                                                                    Ident {
                                                                                        name: "f12",
                                                                                        span: 5367..5370,
                                                                                    },
                                                                                ),
                                                                                span: 5367..5370,
                                                                            },
                                                                        ),
                                                                        span: 5360..5370,
                                                                    },
                                                                ),
                                                                span: 5331..5370,
                                                            },
                                                        ),
                                                        span: 5107..5370,
                                                    },
                                                    Expression {
                                                        kind: And(
                                                            Expression {
                                                                kind: And(
                                                                    Expression {
                                                                        kind: Is(
                                                                            Expression {
                                                                                kind: Identifier(
                                                                                    Ident {
                                                                                        name: "f20",
                                                                                        span: 5387..5390,
                                                                                    },
                                                                                ),
                                                                                span: 5387..5390,
                                                                            },
                                                                            true,
                                                                        ),
                                                                        span: 5387..5398,
                                                                    },
                                                                    Expression {
                                                                        kind: Equal(
                                                                            Expression {
                                                                                kind: Identifier(
                                                                                    Ident {
                                                                                        name: "f20",
                                                                                        span: 5402..5405,
                                                                                    },
                                                                                ),
                                                                                span: 5402..5405,
                                                                            },
                                                                            Expression {
                                                                                kind: Identifier(
                                                                                    Ident {
                                                                                        name: "f21",
                                                                                        span: 5409..5412,
                                                                                    },
                                                                                ),
                                                                                span: 5409..5412,
                                                                            },
                                                                        ),
                                                                        span: 5402..5412,
                                                                    },
                                                                ),
                                                                span: 5387..5412,
                                                            },
                                                            Expression {
                                                                kind: Equal(
                                                                    Expression {
                                                                        kind: Identifier(
                                                                            Ident {
                                                                                name: "f21",
                                                                                span: 5416..5419,
                                                                            },
                                                                        ),
                                                                        span: 5416..5419,
                                                                    },
                                                                    Expression {
                                                                        kind: Identifier(
                                                                            Ident {
                                                                                name: "f22",
                                                                                span: 5423..5426,
                                                                            },
                                                                        ),
                                                                        span: 5423..5426,
                                                                    },
                                                                ),
                                                                span: 5416..5426,
                                                            },
                                                        ),
                                                        span: 5387..5426,
                                                    },
                                                ),
                                                span: 5107..5426,
                                            },
                                            Expression {
                                                kind: And(
                                                    Expression {
                                                        kind: And(
                                                            Expression {
                                                                kind: Is(
                                                                    Expression {
                                                                        kind: Identifier(
                                                                            Ident {
                                                                                name: "f00",
                                                                                span: 5443..5446,
                                                                            },
                                                                        ),
                                                                        span: 5443..5446,
                                                                    },
                                                                    true,
                                                                ),
                                                                span: 5443..5454,
                                                            },
                                                            Expression {
                                                                kind: Equal(
                                                                    Expression {
                                                                        kind: Identifier(
                                                                            Ident {
                                                                                name: "f00",
                                                                                span: 5458..5461,
                                                                            },
                                                                        ),
                                                                        span: 5458..5461,
                                                                    },
                                                                    Expression {
                                                                        kind: Identifier(
                                                                            Ident {
                                                                                name: "f11",
                                                                                span: 5465..5468,
                                                                            },
                                                                        ),
                                                                        span: 5465..5468,
                                                                    },
                                                                ),
                                                                span: 5458..5468,
                                                            },
                                                        ),
                                                        span: 5443..5468,
                                                    },
                                                    Expression {
                                                        kind: Equal(
                                                            Expression {
                                                                kind: Identifier(
                                                                    Ident {
                                                                        name: "f11",
                                                                        span: 5472..5475,
                                                                    },
                                                                ),
                                                                span: 5472..5475,
                                                            },
                                                            Expression {
                                                                kind: Identifier(
                                                                    Ident {
                                                                        name: "f22",
                                                                        span: 5479..5482,
                                                                    },
                                                                ),
                                                                span: 5479..5482,
                                                            },
                                                        ),
                                                        span: 5472..5482,
                                                    },
                                                ),
                                                span: 5443..5482,
                                            },
                                        ),
                                        span: 5107..5482,
                                    },
                                    Expression {
                                        kind: And(
                                            Expression {
                                                kind: And(
                                                    Expression {
                                                        kind: Is(
                                                            Expression {
                                                                kind: Identifier(
                                                                    Ident {
                                                                        name: "f20",
                                                                        span: 5499..5502,
                                                                    },
                                                                ),
                                                                span: 5499..5502,
                                                            },
                                                            true,
                                                        ),
                                                        span: 5499..5510,
                                                    },
                                                    Expression {
                                                        kind: Equal(
                                                            Expression {
                                                                kind: Identifier(
                                                                    Ident {
                                                                        name: "f20",
                                                                        span: 5514..5517,
                                                                    },
                                                                ),
                                                                span: 5514..5517,
                                                            },
                                                            Expression {
                                                                kind: Identifier(
                                                                    Ident {
                                                                        name: "f11",
                                                                        span: 5521..5524,
                                                                    },
                                                                ),
                                                                span: 5521..5524,
                                                            },
                                                        ),
                                                        span: 5514..5524,
                                                    },
                                                ),
                                                span: 5499..5524,
                                            },
                                            Expression {
                                                kind: Equal(
                                                    Expression {
                                                        kind: Identifier(
                                                            Ident {
                                                                name: "f11",
                                                                span: 5528..5531,
                                                            },
                                                        ),
                                                        span: 5528..5531,
                                                    },
                                                    Expression {
                                                        kind: Identifier(
                                                            Ident {
                                                                name: "f02",
                                                                span: 5535..5538,
                                                            },
                                                        ),
                                                        span: 5535..5538,
                                                    },
                                                ),
                                                span: 5528..5538,
                                            },
                                        ),
                                        span: 5499..5538,
                                    },
                                ),
                                span: 5107..5538,
                            },
                        },
                    ),
                    span: 5099..5540,
                },
            ],
            span: 4089..5541,
        },
    ],
    finish_functions: [
        FinishFunctionDefinition {
            identifier: Ident {
                name: "set_next_player",
                span: 498..513,
            },
            arguments: [
                FieldDefinition {
                    identifier: Ident {
                        name: "gameID",
                        span: 514..520,
                    },
                    field_type: VType {
                        kind: Id,
                        span: 521..523,
                    },
                },
                FieldDefinition {
                    identifier: Ident {
                        name: "to_input",
                        span: 525..533,
                    },
                    field_type: VType {
                        kind: String,
                        span: 534..540,
                    },
                },
            ],
            statements: [
                Statement {
                    kind: Update(
                        UpdateStatement {
                            fact: FactLiteral {
                                identifier: Ident {
                                    name: "NextPlayer",
                                    span: 555..565,
                                },
                                key_fields: [
                                    (
                                        Ident {
                                            name: "gameID",
                                            span: 566..572,
                                        },
                                        Expression(
                                            Expression {
                                                kind: Identifier(
                                                    Ident {
                                                        name: "gameID",
                                                        span: 574..580,
                                                    },
                                                ),
                                                span: 574..580,
                                            },
                                        ),
                                    ),
                                ],
                                value_fields: None,
                            },
                            to: [
                                (
                                    Ident {
                                        name: "p",
                                        span: 586..587,
                                    },
                                    Expression(
                                        Expression {
                                            kind: Identifier(
                                                Ident {
                                                    name: "to_input",
                                                    span: 589..597,
                                                },
                                            ),
                                            span: 589..597,
                                        },
                                    ),
                                ),
                            ],
                        },
                    ),
                    span: 548..598,
                },
            ],
            span: 482..600,
        },
    ],
    global_lets: [],
    text: "---\npolicy-version: 2\n---\n\n```policy\nfact Players[gameID id]=>{x id, o id}\nfact NextPlayer[gameID id]=>{p string}\nfact Field[gameID id, x int, y int]=>{p string}\nfact GameOver[gameID id]=>{}\n\n// Regular functions can only contain data processing statements, must\n// have a return type, and must return a value\nfunction bounds(v int) bool {\n    return v >= 0 && v <= 2\n}\n// finish functions can only be used in finish blocks and can only contain\n// statements valid in finish blocks\nfinish function set_next_player(gameID id, to_input string) {\n    update NextPlayer[gameID: gameID] to {p: to_input}\n}\n\naction StartGame(profileX id, profileO id) {\n    let start_command = Start{\n        ProfileX: profileX,\n        ProfileO: profileO,\n    }\n    publish start_command\n}\n\neffect GameStart {\n    gameID id,\n    x id,\n    o id,\n}\n\ncommand Start {\n    fields {\n        ProfileX id,\n        ProfileO id,\n    }\n\n    policy {\n        check ProfileX != ProfileO\n        // `envelope::command_id` is an FFI-provided helper function that returns\n        // the ID from the passed in `envelope`.\n        let gameID = envelope::command_id(envelope)\n        finish {\n            create PlayerProfile[gameID: gameID]=>{x: ProfileX, o: ProfileO}\n            create NextPlayer[gameID: gameID]=>{p: \"X\"}\n\n            emit GameStart{\n                gameID: gameID,\n                x: ProfileX,\n                o: ProfileO,\n            }\n        }\n    }\n}\n\naction MakeMove(gameID id, x int, y int) {\n    let move_command = Move {\n        gameID: gameID,\n        X: x,\n        Y: y,\n    }\n    publish move_command\n}\n\neffect GameUpdate {\n    gameID id,\n    player id,\n    // the \"dynamic\" keyword is an annotation used to indicate to the consumer\n    // that this value is not based on static event data and may change.\n    p      string dynamic,\n    X      int,\n    Y      int,\n}\n\neffect GameOver {\n    gameID id,\n    winner id,\n    p string,\n}\n\ncommand Move {\n    // phase 0: command field definition\n    fields {\n        gameID id,\n        X int,\n        Y int,\n    }\n\n    policy {\n        // phase 1: variable definition/checks\n        // These aren't \"variables\" in the procedural sense, they are\n        // set-once constant definitions that can be used in later\n        // expressions.\n        // `envelope::author_id` is an FFI-provided helper function which\n        // returns the ID for the author of the command from the passed in\n        // `envelope`.\n        let player = envelope::author_id(envelope)\n        // the query expression searches the fact database for facts which\n        // match the signature, returning an Optional containing either all\n        // values marked with ?, or None. The unwrap expression returns the\n        // value inside an Optional or terminates rule execution.\n        let result = unwrap query PlayerProfile[gameID: gameID]=>{x: ?, o: ?}\n        let playerX = result.x\n        let playerO = result.o\n        let p = unwrap query NextPlayer[gameID: gameID]=>{p: ?}\n        // the if expression works like a ternary expression, where both\n        // branches must be specified.\n        let nextp = if p == \"X\" { :\"O\" } else { :\"X\" }\n\n        // Checks are separated here, but they can be interleaved with let\n        // statements.\n        // Defined variables, command fields, and common event fields can\n        // be checked for validity with boolean expressions.\n        check (p == \"X\" && player == playerX) || (p == \"O\" && player == playerO)\n        // functions can be used in any expression\n        check bounds(X)\n        check bounds(Y)\n\n        // phase 2: fact updates and effects\n        // Facts can be created, updated, and destroyed.\n        // Zero or more effects can be generated.\n        // The finish block ends rule evaluation.\n        finish {\n            create Field[gameID: gameID, x: X, y: Y]=>{p: p}\n            set_next_player(gameID, nextp)\n\n            emit GameUpdate{\n                gameID: gameID,\n                player: player,\n                p: p,\n                X: X,\n                Y: Y,\n            }\n        }\n    }\n}\n\nfunction game_over(gameID id, x int, y int, p string) bool {\n    let f00 = if x == 0 && y == 0 { :Some(p) } else { :query Field[gameID: gameID, x: 0, y: 0]=>{p: ?} }\n    let f10 = if x == 1 && y == 0 { :Some(p) } else { :query Field[gameID: gameID, x: 1, y: 0]=>{p: ?} }\n    let f20 = if x == 2 && y == 0 { :Some(p) } else { :query Field[gameID: gameID, x: 2, y: 0]=>{p: ?} }\n    let f01 = if x == 0 && y == 1 { :Some(p) } else { :query Field[gameID: gameID, x: 0, y: 1]=>{p: ?} }\n    let f11 = if x == 1 && y == 1 { :Some(p) } else { :query Field[gameID: gameID, x: 1, y: 1]=>{p: ?} }\n    let f21 = if x == 2 && y == 1 { :Some(p) } else { :query Field[gameID: gameID, x: 2, y: 1]=>{p: ?} }\n    let f02 = if x == 0 && y == 2 { :Some(p) } else { :query Field[gameID: gameID, x: 0, y: 2]=>{p: ?} }\n    let f12 = if x == 1 && y == 2 { :Some(p) } else { :query Field[gameID: gameID, x: 1, y: 2]=>{p: ?} }\n    let f22 = if x == 2 && y == 2 { :Some(p) } else { :query Field[gameID: gameID, x: 2, y: 2]=>{p: ?} }\n    return (f00 is Some && f00 == f10 && f10 == f20) ||\n           (f01 is Some && f01 == f11 && f11 == f21) ||\n           (f01 is Some && f02 == f12 && f12 == f22) ||\n           (f00 is Some && f00 == f01 && f01 == f02) ||\n           (f10 is Some && f10 == f11 && f11 == f12) ||\n           (f20 is Some && f20 == f21 && f21 == f22) ||\n           (f00 is Some && f00 == f11 && f11 == f22) ||\n           (f20 is Some && f20 == f11 && f11 == f02)\n}\n\ncommand Move2 {\n    fields {\n        gameID id,\n        X int,\n        Y int,\n    }\n\n    policy {\n        let player = envelope::author_id(envelope)\n        let players = unwrap query PlayerProfile[gameID: gameID]=>{x: ?, o: ?}\n        let p = unwrap query NextPlayer[gameID: gameID]=>{p: ?}\n        let nextp = if p == \"X\" { :\"O\" } else { :\"X\" }\n\n        check !exists GameOver[gameID: gameID]=>{}\n        check bounds(X)\n        check bounds(Y)\n        check (p == \"X\" && player == players.x) || (p == \"O\" && player == players.o)\n\n        match game_over(gameID, X, Y, p) {\n            true => {\n                finish {\n                    create Field[gameID: gameID, x: X, y: Y]=>{p: p}\n                    delete NextPlayer[gameID: gameID]=>{p: p}\n                    create GameOver[gameID: gameID]=>{}\n                    emit GameOver{\n                        gameID: gameID,\n                        winner: player,\n                        p: p,\n                    }\n                }\n            }\n            false => {\n                finish {\n                    create Field[gameID: gameID, x: X, y: Y]=>{p: p}\n                    set_next_player(gameID, op)\n                    emit GameUpdate{\n                        gameID: gameID,\n                        player: player,\n                        p: p,\n                        x: X,\n                        y: Y,\n                    }\n                }\n            }\n        }\n    }\n}\n```\n",
}
